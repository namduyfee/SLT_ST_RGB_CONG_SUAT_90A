C51 COMPILER V9.01   WRITEFLASHROM                                                         12/13/2025 09:59:39 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE WRITEFLASHROM
OBJECT MODULE PLACED IN WriteFlashROM.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Project\Source\WriteFlashROM.c LARGE ROM(COMPACT) OPTIMIZE(SIZE) BROWSE NOA
                    -REGS INCDIR(.\Project\include) DEBUG OBJECTEXTEND PRINT(.\WriteFlashROM.lst) OBJECT(WriteFlashROM.obj)

line level    source

   1          #include "WriteFlashROM.h"
   2          #include "CH554.H"
   3          #include <intrins.h>
   4          // ghi du lieu vao vung nho code flash : 12k doi voi CH551, 14k doi voi CH552
   5          #define INVERT(X) ((X<<8)|(X>>8))
   6          void WriteDoubleByteROM(UINT16 Addr, UINT16 *Data, UINT16 lenght)
   7          {
   8   1              data UINT8 i;
   9   1              UINT16 *Pointer;
  10   1              SAFE_MOD = 0x55;                                                                // unlock flash-ROM
  11   1              SAFE_MOD = 0x0AA;                                                               // unlock flash-ROM
  12   1              GLOBAL_CFG |= bCODE_WE ;                                // enable write data and erase
  13   1              Pointer = Data;
  14   1              for(i = 0; i<lenght; i++)
  15   1              {
  16   2                      ROM_ADDR = Addr;                                                        // bit thap nhat luon la 0
  17   2                      ROM_DATA = INVERT(*Pointer);
  18   2                      ROM_CTRL = 0x09A;
  19   2                      Addr+=2;
  20   2                      Pointer++;
  21   2              }
  22   1              SAFE_MOD = 0x55;
  23   1              SAFE_MOD = 0x0AA;
  24   1              GLOBAL_CFG &= (~(bCODE_WE|bDATA_WE));
  25   1      }
  26          //void df_read(uint8_t u8Address)
  27          //{
  28          //      
  29          //      ROM_ADDR = 0xC000 + (u8Address << 1);
  30          //      ROM_CTRL = 0x8E;
  31          
  32          //      return ROM_DATA_L;
  33          //}
  34          
  35          /* ham ghi gia tri vao data flash */
  36          /* u8Address: dia chi 0 - 127 : 0x00 - 0x7F */
  37          /* u8Data: gia tri muon ghi */
  38          /* ket qua tra ve 1 neu thanh cong va 0 neu loi */
  39          //uint8_t df_write(uint8_t u8Address, uint8_t u8Data)
  40          //{
  41          //      SAFE_MOD = 0x55;
  42          //      SAFE_MOD = 0xAA;
  43          //      GLOBAL_CFG = 0x04;
  44          //      ROM_ADDR = 0xC000 + (u8Address << 1);
  45          //      ROM_DATA_L = u8Data;
  46          //      ROM_CTRL = 0x9A;
  47          //      if (ROM_STATUS & 0x02) {
  48          //              SAFE_MOD = 0x55;
  49          //              SAFE_MOD = 0xAA;
  50          //              GLOBAL_CFG = 0x00;
  51          //              return 0;
  52          //      }
  53          //      if (ROM_STATUS & 0x40 ) {
  54          //              SAFE_MOD = 0x55;
C51 COMPILER V9.01   WRITEFLASHROM                                                         12/13/2025 09:59:39 PAGE 2   

  55          //              SAFE_MOD = 0xAA;
  56          //              GLOBAL_CFG = 0x00;
  57          //              return 1;
  58          //      }
  59          //      SAFE_MOD = 0x55;
  60          //      SAFE_MOD = 0xAA;
  61          //      GLOBAL_CFG = 0x00;
  62          //      return 0;
  63          //}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     98    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       7
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
