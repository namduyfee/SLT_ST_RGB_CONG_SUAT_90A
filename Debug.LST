C51 COMPILER V9.01   DEBUG                                                                 12/17/2025 12:02:12 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE DEBUG
OBJECT MODULE PLACED IN Debug.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Debug.C LARGE ROM(COMPACT) OPTIMIZE(SIZE) BROWSE NOAREGS INCDIR(.\Project\i
                    -nclude) DEBUG OBJECTEXTEND

line level    source

   1          /********************************** (C) COPYRIGHT *******************************
   2          * File Name          : Debug.C
   3          * Author             : WCH
   4          * Version            : V1.0
   5          * Date               : 2017/01/20
   6          * Description        : CH554 DEBUG Interface
   7                               CH554Ö÷ÆµÐÞ¸Ä¡¢ÑÓÊ±º¯Êý¶¨Òå
   8                               ´®¿Ú0ºÍ´®¿Ú1³õÊ¼»¯
   9                               ´®¿Ú0ºÍ´®¿Ú1µÄÊÕ·¢×Óº¯Êý
  10                               ¿´ÃÅ¹·³õÊ¼»¯                                                                                
  11          *******************************************************************************/
  12          
  13          #include "CH554.H"
  14          #include "Debug.H"
  15          
  16          /*******************************************************************************
  17          * Function Name  : CfgFsys( )
  18          * Description    : CH554Ê±ÖÓÑ¡ÔñºÍÅäÖÃº¯Êý,Ä¬ÈÏÊ¹ÓÃFsys 6MHz£¬FREQ_SYS¿ÉÒÔÍ¨¹ý
  19                             CLOCK_CFGÅäÖÃµÃµ½£¬¹«Ê½ÈçÏÂ£º
  20                             Fsys = (Fosc * 4/(CLOCK_CFG & MASK_SYS_CK_SEL);¾ßÌåÊ±ÖÓÐèÒª×Ô¼ºÅäÖÃ 
  21          * Input          : None
  22          * Output         : None
  23          * Return         : None
  24          *******************************************************************************/ 
  25          void CfgFsys()  
  26          {
  27   1              SAFE_MOD = 0x55;
  28   1              SAFE_MOD = 0xAA;
  29   1      
  30   1      #if FREQ_SYS == 32000000
                      CLOCK_CFG = CLOCK_CFG & ~ MASK_SYS_CK_SEL | 0x07;  // 32MHz
              #elif FREQ_SYS == 24000000
  33   1              CLOCK_CFG = CLOCK_CFG & ~ MASK_SYS_CK_SEL | 0x06;  // 24MHz     
  34   1      #elif FREQ_SYS == 16000000
                      CLOCK_CFG = CLOCK_CFG & ~ MASK_SYS_CK_SEL | 0x05;  // 16MHz     
              #elif FREQ_SYS == 12000000
                      CLOCK_CFG = CLOCK_CFG & ~ MASK_SYS_CK_SEL | 0x04;  // 12MHz
              #elif FREQ_SYS == 6000000
                      CLOCK_CFG = CLOCK_CFG & ~ MASK_SYS_CK_SEL | 0x03;  // 6MHz      
              #elif FREQ_SYS == 3000000
                      CLOCK_CFG = CLOCK_CFG & ~ MASK_SYS_CK_SEL | 0x02;  // 3MHz      
              #elif FREQ_SYS == 750000
                      CLOCK_CFG = CLOCK_CFG & ~ MASK_SYS_CK_SEL | 0x01;  // 750KHz    
              #elif FREQ_SYS == 187500
                      CLOCK_CFG = CLOCK_CFG & ~ MASK_SYS_CK_SEL | 0x00;  // 187.5MHz          
              #else
                      #warning FREQ_SYS invalid or not set
              #endif
  49   1      
  50   1              SAFE_MOD = 0x00;
  51   1      }
  52          
  53          /*******************************************************************************
  54          * Function Name  : mDelayus(UNIT16 n)
C51 COMPILER V9.01   DEBUG                                                                 12/17/2025 12:02:12 PAGE 2   

  55          * Description    : usÑÓÊ±º¯Êý
  56          * Input          : UNIT16 n
  57          * Output         : None
  58          * Return         : None
  59          *******************************************************************************/ 
  60          void    mDelayuS( UINT16 n )  // ÒÔuSÎªµ¥Î»ÑÓÊ±
  61          {
  62   1      #ifdef  FREQ_SYS
  63   1      #if             FREQ_SYS <= 6000000
                              n >>= 2;
              #endif
  66   1      #if             FREQ_SYS <= 3000000
                              n >>= 2;
              #endif
  69   1      #if             FREQ_SYS <= 750000
                              n >>= 4;
              #endif
  72   1      #endif
  73   1              while ( n ) {  // total = 12~13 Fsys cycles, 1uS @Fsys=12MHz
  74   2                      ++ SAFE_MOD;  // 2 Fsys cycles, for higher Fsys, add operation here
  75   2      #ifdef  FREQ_SYS
  76   2      #if             FREQ_SYS >= 14000000
  77   2                      ++ SAFE_MOD;
  78   2      #endif
  79   2      #if             FREQ_SYS >= 16000000
  80   2                      ++ SAFE_MOD;
  81   2      #endif
  82   2      #if             FREQ_SYS >= 18000000
  83   2                      ++ SAFE_MOD;
  84   2      #endif
  85   2      #if             FREQ_SYS >= 20000000
  86   2                      ++ SAFE_MOD;
  87   2      #endif
  88   2      #if             FREQ_SYS >= 22000000
  89   2                      ++ SAFE_MOD;
  90   2      #endif
  91   2      #if             FREQ_SYS >= 24000000
  92   2                      ++ SAFE_MOD;
  93   2      #endif
  94   2      #if             FREQ_SYS >= 26000000
                              ++ SAFE_MOD;
              #endif
  97   2      #if             FREQ_SYS >= 28000000
                              ++ SAFE_MOD;
              #endif
 100   2      #if             FREQ_SYS >= 30000000
                              ++ SAFE_MOD;
              #endif
 103   2      #if             FREQ_SYS >= 32000000
                              ++ SAFE_MOD;
              #endif
 106   2      #endif
 107   2                      -- n;
 108   2              }
 109   1      }
 110          
 111          /*******************************************************************************
 112          * Function Name  : mDelayms(UNIT16 n)
 113          * Description    : msÑÓÊ±º¯Êý
 114          * Input          : UNIT16 n
 115          * Output         : None
 116          * Return         : None
C51 COMPILER V9.01   DEBUG                                                                 12/17/2025 12:02:12 PAGE 3   

 117          *******************************************************************************/
 118          void    mDelaymS( UINT16 n )                                                  // ÒÔmSÎªµ¥Î»ÑÓÊ±
 119          {
 120   1              while ( n ) {
 121   2      #ifdef  DELAY_MS_HW
                              while ( ( TKEY_CTRL & bTKC_IF ) == 0 );
                              while ( TKEY_CTRL & bTKC_IF );
              #else
 125   2                      mDelayuS( 1000 );
 126   2      #endif
 127   2                      -- n;
 128   2              }
 129   1      }                                         
 130          
 131          /*******************************************************************************
 132          * Function Name  : CH554UART0Alter()
 133          * Description    : CH554´®¿Ú0Òý½ÅÓ³Éä,´®¿ÚÓ³Éäµ½P0.2ºÍP0.3
 134          * Input          : None
 135          * Output         : None
 136          * Return         : None
 137          *******************************************************************************/
 138          //void CH554UART0Alter()
 139          //{
 140          //    PIN_FUNC |= bUART0_PIN_X;                                                  //´®¿ÚÓ³Éäµ½P1.2ºÍP1.3
 141          //}
 142          
 143          /*******************************************************************************
 144          * Function Name  : mInitSTDIO()
 145          * Description    : CH554´®¿Ú0³õÊ¼»¯,Ä¬ÈÏÊ¹ÓÃT1×÷UART0µÄ²¨ÌØÂÊ·¢ÉúÆ÷,Ò²¿ÉÒÔÊ¹ÓÃT2
 146                             ×÷Îª²¨ÌØÂÊ·¢ÉúÆ÷
 147          * Input          : None
 148          * Output         : None
 149          * Return         : None
 150          *******************************************************************************/
 151          void    mInitSTDIO( )
 152          {
 153   1          volatile UINT32 x;
 154   1          volatile UINT8 x2;
 155   1      
 156   1          SM0 = 0;
 157   1          SM1 = 1;
 158   1          SM2 = 0;                                                                   //??0????1
 159   1                                                                                     //??Timer1????????
 160   1          RCLK = 0;                                                                  //UART0????
 161   1          TCLK = 0;                                                                  //UART0????
 162   1          PCON |= SMOD;
 163   1          x = 10 * FREQ_SYS / UART0_BAUD / 16;                                       //??????,??x??????
 164   1          x2 = x % 10;
 165   1          x /= 10;
 166   1          if ( x2 >= 5 ) x ++;                                                       //????
 167   1      
 168   1          TMOD = TMOD & ~ bT1_GATE & ~ bT1_CT & ~ MASK_T1_MOD | bT1_M1;              //0X20,Timer1??8????????
 169   1          T2MOD = T2MOD | bTMR_CLK | bT1_CLK;                                        //Timer1????
 170   1          TH1 = 0-x;                                                                 //12MHz??,buad/12?????????
 171   1          TR1 = 1;                                                                   //?????1
 172   1          TI = 1;
 173   1          REN = 1;                                                                   //??0????
 174   1      }
 175          
 176          /*******************************************************************************
 177          * Function Name  : CH554UART0RcvByte()
 178          * Description    : CH554UART0½ÓÊÕÒ»¸ö×Ö½Ú
C51 COMPILER V9.01   DEBUG                                                                 12/17/2025 12:02:12 PAGE 4   

 179          * Input          : None
 180          * Output         : None
 181          * Return         : SBUF
 182          *******************************************************************************/
 183          //UINT8  CH554UART0RcvByte( )
 184          //{
 185          //    while(RI == 0);                                                            //²éÑ¯½ÓÊÕ£¬ÖÐ¶Ï·½Ê½¿É²»Ó
             -Ã
 186          //    RI = 0;
 187          //    return SBUF;
 188          //}
 189          
 190          /*******************************************************************************
 191          * Function Name  : CH554UART0SendByte(UINT8 SendDat)
 192          * Description    : CH554UART0·¢ËÍÒ»¸ö×Ö½Ú
 193          * Input          : UINT8 SendDat£»Òª·¢ËÍµÄÊý¾Ý
 194          * Output         : None
 195          * Return         : None
 196          *******************************************************************************/
 197          //void CH554UART0SendByte(UINT8 SendDat)
 198          //{
 199          //      SBUF = SendDat;                                                              //²éÑ¯·¢ËÍ£¬ÖÐ¶Ï·½Ê½¿É²»ÓÃ
             -ÏÂÃæ2ÌõÓï¾ä,µ«·¢ËÍÇ°ÐèTI=0
 200          //      while(TI ==0);
 201          //      TI = 0;
 202          //}
 203          
 204          
 205          /*******************************************************************************
 206          * Function Name  : UART1Setup()
 207          * Description    : CH554´®¿Ú1³õÊ¼»¯
 208          * Input          : None
 209          * Output         : None
 210          * Return         : None
 211          *******************************************************************************/
 212          void    UART1Setup( )
 213          {
 214   1         U1SM0 = 0;                                                                   //UART1Ñ¡Ôñ8Î»Êý¾ÝÎ»
 215   1         U1SMOD = 1;                                                                  //¿ìËÙÄ£Ê½
 216   1         U1REN = 1;                                                                   //Ê¹ÄÜ½ÓÊÕ
 217   1         SBAUD1 = 0 - FREQ_SYS/16/UART1_BUAD;
 218   1      }
 219          
 220          /*******************************************************************************
 221          * Function Name  : CH554UART1RcvByte()
 222          * Description    : CH554UART1½ÓÊÕÒ»¸ö×Ö½Ú
 223          * Input          : None
 224          * Output         : None
 225          * Return         : SBUF
 226          *******************************************************************************/
 227          //UINT8  CH554UART1RcvByte( )
 228          //{
 229          //    while(U1RI == 0);                                                           //²éÑ¯½ÓÊÕ£¬ÖÐ¶Ï·½Ê½¿É²»
             -ÓÃ
 230          //    U1RI = 0;
 231          //    return SBUF1;
 232          //}
 233          
 234          /*******************************************************************************
 235          * Function Name  : CH554UART1SendByte(UINT8 SendDat)
 236          * Description    : CH554UART1·¢ËÍÒ»¸ö×Ö½Ú
 237          * Input          : UINT8 SendDat£»Òª·¢ËÍµÄÊý¾Ý
C51 COMPILER V9.01   DEBUG                                                                 12/17/2025 12:02:12 PAGE 5   

 238          * Output         : None
 239          * Return         : None
 240          *******************************************************************************/
 241          //void CH554UART1SendByte(UINT8 SendDat)
 242          //{
 243          //      SBUF1 = SendDat;                                                             //²éÑ¯·¢ËÍ£¬ÖÐ¶Ï·½Ê½¿É²»ÓÃ
             -ÏÂÃæ2ÌõÓï¾ä,µ«·¢ËÍÇ°ÐèTI=0
 244          //      while(U1TI ==0);
 245          //      U1TI = 1;
 246          //}
 247          
 248          /*******************************************************************************
 249          * Function Name  : CH554WDTModeSelect(UINT8 mode)
 250          * Description    : CH554¿´ÃÅ¹·Ä£Ê½Ñ¡Ôñ
 251          * Input          : UINT8 mode 
 252                             0  timer
 253                             1  watchDog
 254          * Output         : None
 255          * Return         : None
 256          *******************************************************************************/
 257          void CH554WDTModeSelect(UINT8 mode)
 258          {
 259   1         SAFE_MOD = 0x55;
 260   1         SAFE_MOD = 0xaa;                                                             //½øÈë°²È«Ä£Ê½
 261   1         if(mode){
 262   2           GLOBAL_CFG |= bWDOG_EN;                                                    //Æô¶¯¿´ÃÅ¹·¸´Î»
 263   2         }
 264   1         else GLOBAL_CFG &= ~bWDOG_EN;                                                    //Æô¶¯¿´ÃÅ¹·½ö½ö×÷Îª¶¨Ê±Æ÷
 265   1         SAFE_MOD = 0x00;                                                             //ÍË³ö°²È«Ä£Ê½
 266   1         WDOG_COUNT = 0;                                                              //¿´ÃÅ¹·¸³³õÖµ
 267   1      }
 268          
 269          /*******************************************************************************
 270          * Function Name  : CH554WDTFeed(UINT8 tim)
 271          * Description    : CH554¿´ÃÅ¹·¶¨Ê±Ê±¼äÉèÖÃ
 272          * Input          : UINT8 tim ¿´ÃÅ¹·¸´Î»Ê±¼äÉèÖÃ
 273                             00H(6MHz)=2.8s
 274                             80H(6MHz)=1.4s
 275          * Output         : None
 276          * Return         : None
 277          *******************************************************************************/
 278          void CH554WDTFeed(UINT8 tim)
 279          {
 280   1         WDOG_COUNT = tim;                                                             //¿´ÃÅ¹·¼ÆÊýÆ÷¸³Öµ     
 281   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    232    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
