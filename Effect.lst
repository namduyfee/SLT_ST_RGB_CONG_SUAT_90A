C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE EFFECT
OBJECT MODULE PLACED IN Effect.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Project\Source\Effect.c LARGE ROM(COMPACT) OPTIMIZE(SIZE) BROWSE NOAREGS IN
                    -CDIR(.\Project\include) DEBUG OBJECTEXTEND PRINT(.\Effect.lst) OBJECT(Effect.obj)

line level    source

   1          #include "Effect.h"
   2          #include "savedata.h"
   3          #include "stdlib.h"
   4          #include "Effect_RGBDance.h"
   5          #include "Debug.H"
   6          #include <stdio.h>
   7          RGB_PIN  RedGreenBlue[3];
   8          extern uint8_t idata ADC_Value;
   9          uint8_t Delay_Music_MONO=10;
  10          extern RGB_DATA RGB_DataRam;
  11          const uint32_t xdata ColorTable[7] = {RGB_RED, RGB_GREEN, RGB_BLUE, RGB_YELLOW, RGB_CYAN, RGB_PURPLE, RGB_
             -WHITE};
  12          extern uint32_t xdata i,j;
  13          extern uint8_t idata Run_Effect_Done;
  14          static  uint8_t xdata k=0, m=0, Flag_Button =0,Flag_Music=0,__Flag_mode=0;
  15          static uint16_t xdata  t=0;
  16          static uint8_t xdata _dBLast = 0;
  17          extern uint8_t xdata _FlagMusic,_FlagFade;
  18          static const uint8_t xdata chu_so[10] = {0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90};
  19          extern uint8_t Effect_Time4;
  20          extern uint8_t xdata u8TH1_Tmp,u8TL1_Tmp;
  21          uint8_t idata But_Count = 0;
  22          static const uint8_t xdata Prog_Auto[4][7] =
  23          {  //Chuong trinh hieu ung cho cac che do auto khac nhau
  24                 1, 2, 3, 4, 5, 6,7,    //Auto 1
  25                 3, 5, 3, 5, 3, 5,3,    //Auto 2
  26                 6, 3, 5, 6, 3, 5,6,    //Auto 3
  27                 7, 5, 6, 7, 5, 6,7,    //Auto 4
  28          };
  29          extern uint8_t xdata DataSave[11];
  30          void RGB_PinInit(void)
  31          {
  32   1          RedGreenBlue[0].Duty      = 0;
  33   1          RedGreenBlue[1].Duty      = 0;
  34   1          RedGreenBlue[2].Duty      = 0;
  35   1      }
  36          uint8_t Audio_Convert(uint8_t ADC_Value_In)
  37          {
  38   1          uint8_t _dBData;
  39   1          _dBData = ((ADC_Value_In/value)*2);
  40   1      //              if(_dBData >254)
  41   1      //                      _dBData = 255;
  42   1          if(_dBData > _dBLast)
  43   1                      {
  44   2                               Effect_Time4 = 0;
  45   2                               _dBLast = _dBData;
  46   2          }
  47   1                      else
  48   1                      {
  49   2                               if(Effect_Time4>Delay_Music_MONO)
  50   2                                      {
  51   3                                              Effect_Time4 = 0;
  52   3                                              if(_dBLast > _dBData)_dBLast--;  //Lam muot khi bien do giam
  53   3                                      }
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 2   

  54   2          }
  55   1          return _dBLast;
  56   1      }
  57           uint8_t LastMode = 0xff;
  58          void RGB_SetModeSpeed(uint8_t Mode)
  59          {
  60   1              if(LastMode!=Mode)
  61   1              {
  62   2                      TR1 = 0;
  63   2                      if(Mode == 1)
  64   2                              T2MOD |= (bTMR_CLK | bT1_CLK);
  65   2                      else if(Mode == 4)
  66   2                      {
  67   3                              T2MOD |= bT1_CLK;
  68   3                              T2MOD &= ~bTMR_CLK;
  69   3                      }
  70   2                      else
  71   2                              T2MOD &= ~bT1_CLK;
  72   2                      TR1 = 1;
  73   2                      LastMode = Mode;
  74   2              }
  75   1      //    if(Mode < 8)
  76   1      //    {
  77   1      //        T3CON &= ~0x07; T3CON |= Mode&0x07;   //Bo chia tan
  78   1      //    }
  79   1      }
  80          void RGB_SetSpeed(uint8_t Speed)
  81          {
  82   1          uint16_t Temp;
  83   1          if(Speed < MIN_SPEED || Speed > MAX_SPEED)return;
  84   1          TR1 = 0;
  85   1          Temp = VALUE_TEMP*((MAX_SPEED+1)-Speed);
  86   1                      u8TH1_Tmp = (65536-Temp)/256;
  87   1                      u8TL1_Tmp = (65536-Temp)%256;  
  88   1                      TH1 = u8TH1_Tmp;
  89   1                      TL1 = u8TL1_Tmp;  
  90   1          ET1 = 1;           //Cau hinh ngat
  91   1          TR1 = 1;
  92   1      }
  93          void RGB_SetBright(uint8_t Brightness)
  94          {
  95   1          RedGreenBlue[RED].Duty = (uint16_t)(RGB_DataRam.Color.DutyRed * Brightness) / MAX_BRIGHTNESS;
  96   1          RedGreenBlue[GREEN].Duty = (uint16_t)(RGB_DataRam.Color.DutyGreen * Brightness) / MAX_BRIGHTNESS;
  97   1          RedGreenBlue[BLUE].Duty = (uint16_t)(RGB_DataRam.Color.DutyBlue * Brightness) / MAX_BRIGHTNESS;
  98   1      
  99   1      }
 100          void RGB_SetColor(uint32_t Color, uint8_t Brightness)
 101          {
 102   1          RGB_DataRam.Color.DutyRed = (uint8_t)(Color>>16);
 103   1          RGB_DataRam.Color.DutyGreen = (uint8_t)(Color>>8);
 104   1          RGB_DataRam.Color.DutyBlue = (uint8_t)(Color);
 105   1          RGB_SetBright(Brightness);
 106   1      }
 107          void SetColor(uint8_t color, uint8_t duty, uint8_t bright)
 108          {
 109   1          if(color == RED)RGB_DataRam.Color.DutyRed = duty;
 110   1          else if(color == GREEN)RGB_DataRam.Color.DutyGreen = duty;
 111   1          else if(color == BLUE)RGB_DataRam.Color.DutyBlue = duty;
 112   1          else return;
 113   1                      if(!_FlagMusic)
 114   1                              RedGreenBlue[color].Duty = (uint16_t)(duty * bright) / MAX_BRIGHTNESS;
 115   1                      else
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 3   

 116   1                              RedGreenBlue[color].Duty = duty;//(uint16_t)(duty * bright) / MAX_BRIGHTNESS;
 117   1      }
 118          void LED7_OutData(uint8_t Data)
 119          {
 120   1        LED7_DATA_A  =  ((Data&0x01)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 121   1        LED7_DATA_B  =  ((Data&0x02)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 122   1        LED7_DATA_C  =  ((Data&0x04)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 123   1        LED7_DATA_D  =  ((Data&0x08)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 124   1        LED7_DATA_E  =  ((Data&0x10)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 125   1        LED7_DATA_F  =  ((Data&0x20)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 126   1        LED7_DATA_G  =  ((Data&0x40)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 127   1      }
 128          void Display_LED_7(uint8_t Num)
 129          {
 130   1          if(Num > 9)return;
 131   1          LED7_OutData(chu_so[Num]);
 132   1      }
 133          void RGB_OnDisplay(void)
 134          {
 135   1          TR0 = 1;
 136   1      }
 137          void RGB_OffDisplay(void)
 138          {
 139   1          TR0 = 0;
 140   1                      GPIO_RED_OFF();
 141   1                      GPIO_GREEN_OFF();
 142   1                      GPIO_BLUE_OFF();
 143   1      }
 144          void SetProcessAutoEffect(uint8_t AutoEffect)    //Save  o day
 145          {
 146   1           RGB_DataRam.LastEffect = 2;
 147   1           RGB_DataRam.AutoEffect = AutoEffect;
 148   1           RGB_DataRam.Effect = Prog_Auto[AutoEffect-1][0];
 149   1      //     RGB_DataRom.AutoEffect = RGB_DataRam.AutoEffect;
 150   1      //     RGB_DataRom.Effect = RGB_DataRam.Effect;
 151   1                       //IAP_AP_Erase_Pages(17920,1);
 152   1                       SAVEDATA();
 153   1           i = j = m = 0;
 154   1           RGB_SetColor(RGB_BLACK, RGB_DataRam.Brightness);
 155   1      }
 156          FLAG_KEY KEY_GetKey (void)
 157          {
 158   1              uint8_t i=0;
 159   1              if (RGB_DataRam.Flags)
 160   1              {
 161   2                      if ((BUT_DON_DA==0)&&(BUT_SPEED!=0)&&(BUT_MUSIC!=0))
 162   2                      {
 163   3                              mDelaymS(40);
 164   3                              if ((BUT_DON_DA==0)&&(BUT_SPEED!=0)&&(BUT_MUSIC!=0))
 165   3                                      return __KEY_FLASH;
 166   3      //                      {
 167   3      //                              for (i=0;i<50;i++)
 168   3      //                              {
 169   3      //                               if (!((BUT_DON_DA==0)&&(BUT_SPEED!=0)&&(BUT_MUSIC!=0)))
 170   3      //                                       break;
 171   3      //                               mDelaymS(10);
 172   3      //                              }
 173   3      //                      }
 174   3      //                      if (i>=50) return __KEY_FLASH_LONG;
 175   3      //              else return __KEY_FLASH;
 176   3                      }
 177   2      
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 4   

 178   2                      else if ((BUT_DON_DA!=0)&&(BUT_SPEED==0)&&(BUT_MUSIC!=0))
 179   2                      {
 180   3                              mDelaymS(40);
 181   3                              if ((BUT_DON_DA!=0)&&(BUT_SPEED==0)&&(BUT_MUSIC!=0))
 182   3                                      return __KEY_SPEED;
 183   3      //                      {
 184   3      //                              for (i=0;i<50;i++)
 185   3      //                              {
 186   3      //                               if (!((BUT_DON_DA!=0)&&(BUT_SPEED==0)&&(BUT_MUSIC!=0)))
 187   3      //                                       break;
 188   3      //                               mDelaymS(10);
 189   3      //                              }
 190   3      //                      }
 191   3      //                      if (i>=50) return __NO_KEY;
 192   3      //                      else return __KEY_SPEED;
 193   3                      }
 194   2                      else if ((BUT_DON_DA!=0)&&(BUT_SPEED!=0)&&(BUT_MUSIC==0))
 195   2                      {
 196   3                              mDelaymS(40);
 197   3                              if ((BUT_DON_DA!=0)&&(BUT_SPEED!=0)&&(BUT_MUSIC==0))
 198   3                                      return __KEY_MUSIC;
 199   3      //                      {
 200   3      //                              for (i=0;i<50;i++)
 201   3      //                              {
 202   3      //                               if (!((BUT_DON_DA!=0)&&(BUT_SPEED!=0)&&(BUT_MUSIC==0)))
 203   3      //                                       break;
 204   3      //                               mDelaymS(10);
 205   3      //                              }
 206   3      //                      }
 207   3      //                      if (i>=50) return __NO_KEY;
 208   3      //                      else return __KEY_MUSIC;
 209   3                      }
 210   2              }
 211   1              return __NO_KEY;
 212   1      }
 213          void Check_Button(uint8_t Bright)                                                                       // han nay chua xu ly
 214          {
 215   1              uint8_t Key=KEY_GetKey();
 216   1              switch (Key)
 217   1              {
 218   2          case __KEY_FLASH:
 219   2          {
 220   3                              But_Count++;
 221   3                              if(But_Count >= 7) //DA
 222   3                              {
 223   4                                      if (_FlagMusic) _FlagMusic=0;
 224   4              if(RGB_DataRam.AutoEffect==6)
 225   4               RGB_OnDisplay();
 226   4              if(RGB_DataRam.LastEffect == 2)
 227   4                RGB_DataRam.Effect = RGB_DataRam.SaveEffect;
 228   4                      else
 229   4              {
 230   5                                              if(++RGB_DataRam.Effect > 7)
 231   5                                              {
 232   6                                                      But_Count = 0;
 233   6                                                      RGB_DataRam.Effect = 1;
 234   6                                              }
 235   5                                                      RGB_DataRam.SaveEffect = RGB_DataRam.Effect;
 236   5              }
 237   4              RGB_DataRam.LastEffect = 1;
 238   4              RGB_DataRam.AutoEffect = 0;
 239   4              i = j = m = 0;
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 5   

 240   4              RGB_SetColor(RGB_BLACK, RGB_DataRam.Brightness);
 241   4                                      SAVEDATA();
 242   4                              }
 243   3                              if(But_Count < 7) //DON
 244   3                              {
 245   4                                      if (RGB_DataRam.Effect == 10)
 246   4                                      {
 247   5                                              Delay_Music_MONO=20;
 248   5                                              RGB_DataRam.Effect = 0;
 249   5                                              //if (_FlagFade==0)_FlagFade=1;
 250   5                                              if(RGB_DataRam.AutoEffect==6)
 251   5                              RGB_OnDisplay();
 252   5                if(++k>6)k=0;
 253   5                              RGB_SetColor(ColorTable[k],Bright);
 254   5                                              if(_FlagFade == 1) 
 255   5                                                      RGB_DataRam.AutoEffect=8;
 256   5                                              else
 257   5                                                      RGB_DataRam.AutoEffect=0;
 258   5                                      }
 259   4                                      else
 260   4                                      {
 261   5                                              RGB_DataRam.Effect = 0;
 262   5                                              if(RGB_DataRam.AutoEffect==6)
 263   5                              RGB_OnDisplay();
 264   5                if(++k>6)k=0;
 265   5                              RGB_SetColor(ColorTable[k],RGB_DataRam.Brightness);
 266   5                                              if(_FlagFade == 1) 
 267   5                                                      RGB_DataRam.AutoEffect=8;
 268   5                                              else
 269   5                                                      RGB_DataRam.AutoEffect=0;
 270   5                                      }
 271   4                                      SAVEDATA();
 272   4                              }
 273   3                              break;
 274   3                      }
 275   2      //    case __KEY_MONO:
 276   2      //    {
 277   2      //                              if (RGB_DataRam.Effect == 10)
 278   2      //                              {
 279   2      //                                      Delay_Music_MONO=20;
 280   2      //                                      RGB_DataRam.Effect = 0;
 281   2      //                                      //if (_FlagFade==0)_FlagFade=1;
 282   2      //                                      if(RGB_DataRam.AutoEffect==6)
 283   2      //                      RGB_OnDisplay();
 284   2      //                if(++k>6)k=0;
 285   2      //                              RGB_SetColor(ColorTable[k],Bright);
 286   2      //                                      if(_FlagFade == 1) 
 287   2      //                                              RGB_DataRam.AutoEffect=8;
 288   2      //                                      else
 289   2      //                                              RGB_DataRam.AutoEffect=0;
 290   2      //                              }
 291   2      //                              else
 292   2      //                              {
 293   2      //                                      RGB_DataRam.Effect = 0;
 294   2      //                                      if(RGB_DataRam.AutoEffect==6)
 295   2      //                      RGB_OnDisplay();
 296   2      //                if(++k>6)k=0;
 297   2      //                              RGB_SetColor(ColorTable[k],RGB_DataRam.Brightness);
 298   2      //                                      if(_FlagFade == 1) 
 299   2      //                                              RGB_DataRam.AutoEffect=8;
 300   2      //                                      else
 301   2      //                                              RGB_DataRam.AutoEffect=0;
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 6   

 302   2      //                              }
 303   2      //                              SAVEDATA();
 304   2      //                              break;
 305   2      //    }
 306   2                      case __KEY_MONO_LONG:
 307   2          {
 308   3                              
 309   3                                      _FlagFade = !_FlagFade;
 310   3                                      if(_FlagFade == 1) 
 311   3                                              RGB_DataRam.AutoEffect=8;
 312   3                                      else
 313   3                                              RGB_DataRam.AutoEffect=0;                       
 314   3                                      RGB_SetColor(RGB_RED,RGB_DataRam.Brightness);
 315   3                                      SAVEDATA();
 316   3                              break;
 317   3                      }
 318   2          case __KEY_MUSIC:
 319   2          {
 320   3                              if (++__Flag_mode>=2)
 321   3                                      __Flag_mode=0;
 322   3                              if (__Flag_mode==1)
 323   3                              {
 324   4      
 325   4              if (_FlagMusic) _FlagMusic=0;
 326   4                      RGB_DataRam.LastEffect = 2;
 327   4                      RGB_DataRam.AutoEffect = 6;
 328   4                      RGB_DataRam.Effect = 10;
 329   4                      i = j = m = 0;
 330   4               RGB_SetColor(RGB_BLACK, RGB_DataRam.Brightness); 
 331   4                              }
 332   3                              else
 333   3                              {
 334   4                                              if (_FlagMusic) _FlagMusic=0;
 335   4                      RGB_DataRam.LastEffect = 2;
 336   4                      RGB_DataRam.AutoEffect = 7;
 337   4                      RGB_DataRam.Effect = 10;
 338   4                      i = j = m = 0;
 339   4               RGB_SetColor(RGB_BLACK, RGB_DataRam.Brightness); 
 340   4                              }
 341   3                              SAVEDATA();
 342   3                              break;
 343   3          }
 344   2          case __KEY_SPEED:
 345   2          {
 346   3             if (RGB_DataRam.Effect == 0)
 347   3             {
 348   4               if(++RGB_DataRam.Brightness > MAX_BRIGHTNESS)
 349   4               {
 350   5                   RGB_DataRam.Brightness = MIN_BRIGHTNESS;
 351   5               }
 352   4               if(!RGB_DataRam.Effect)
 353   4                  RGB_SetBright(RGB_DataRam.Brightness);
 354   4             }
 355   3             else
 356   3             {
 357   4                                       RGB_DataRam.Speed += 2;
 358   4              if(RGB_DataRam.Speed > MAX_SPEED)
 359   4              {
 360   5                   RGB_DataRam.Speed = MIN_SPEED;
 361   5              }
 362   4               RGB_SetSpeed(RGB_DataRam.Speed);
 363   4             }
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 7   

 364   3                              SAVEDATA();
 365   3                              break;
 366   3          }
 367   2              }
 368   1              while ((Key=KEY_GetKey())!=__NO_KEY);
 369   1      }
 370          
 371          void RGB_ProcessKey(uint32_t Key, uint8_t Bright)
 372          {
 373   1        if((Key==KEY_RED_MH)||(Key==KEY_RED))
 374   1          {
 375   2             RGB_DataRam.Effect = 0;
 376   2             RGB_SetColor(RGB_RED, Bright);
 377   2                              if (_FlagMusic) _FlagMusic=0;
 378   2          }
 379   1          else if((Key==KEY_BLUE_MH)||(Key==KEY_BLUE))
 380   1          {
 381   2             RGB_DataRam.Effect = 0;
 382   2             RGB_SetColor(RGB_BLUE, Bright);
 383   2                              if (_FlagMusic) _FlagMusic=0;
 384   2          }
 385   1          else if((Key==KEY_GREEN_MH)||(Key==KEY_GREEN))
 386   1          {
 387   2             RGB_DataRam.Effect = 0;
 388   2             RGB_SetColor(RGB_GREEN, Bright);
 389   2                              if (_FlagMusic) _FlagMusic=0;
 390   2          }
 391   1          else if((Key==KEY_WHITE_MH)||(Key==KEY_WHITE))
 392   1          {
 393   2             RGB_DataRam.Effect = 0;
 394   2             RGB_SetColor(RGB_WHITE, Bright);
 395   2                              if (_FlagMusic) _FlagMusic=0;
 396   2          }
 397   1          else if((Key==KEY_ORANGE_MH)||(Key==KEY_ORANGE))
 398   1          {
 399   2             RGB_DataRam.Effect = 0;
 400   2             RGB_SetColor(RGB_ORANGE, Bright);
 401   2                              if (_FlagMusic) _FlagMusic=0;
 402   2          }
 403   1          else if((Key==KEY_YELLOW_MH)||(Key==KEY_YELLOW))
 404   1          {
 405   2             RGB_DataRam.Effect = 0;
 406   2             RGB_SetColor(RGB_YELLOW, Bright);
 407   2                              if (_FlagMusic) _FlagMusic=0;
 408   2          }
 409   1          else if((Key==KEY_CYAN_MH)||(Key==KEY_CYAN))
 410   1          {
 411   2             RGB_DataRam.Effect = 0;
 412   2             RGB_SetColor(RGB_CYAN, Bright);
 413   2                              if (_FlagMusic) _FlagMusic=0;
 414   2          }
 415   1          else if((Key==KEY_PURPLE_MH)||(Key==KEY_PURPLE))
 416   1          {
 417   2             RGB_DataRam.Effect = 0;
 418   2             RGB_SetColor(RGB_PURPLE, Bright);
 419   2                              if (_FlagMusic) _FlagMusic=0;
 420   2          }
 421   1          else if((Key==KEY_GREEN2_MH)||(Key==KEY_GREEN2))
 422   1          {
 423   2             RGB_DataRam.Effect = 0;
 424   2             RGB_SetColor(RGB_GREEN2, Bright);
 425   2                              if (_FlagMusic) _FlagMusic=0;
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 8   

 426   2          }
 427   1          else if((Key==KEY_BLUE2_MH)||(Key==KEY_BLUE2))
 428   1          {
 429   2             RGB_DataRam.Effect = 0;
 430   2             RGB_SetColor(RGB_BLUE2, Bright);
 431   2                              if (_FlagMusic) _FlagMusic=0;
 432   2          }
 433   1          else if((Key==KEY_ORANGE2_MH)||(Key==KEY_ORANGE2))
 434   1          {
 435   2             RGB_DataRam.Effect = 0;
 436   2             RGB_SetColor(RGB_ORANGE2, Bright);
 437   2                              if (_FlagMusic) _FlagMusic=0;
 438   2          }
 439   1          else if((Key==KEY_ORANGE3_MH)||(Key==KEY_ORANGE3))
 440   1          {
 441   2             RGB_DataRam.Effect = 0;
 442   2             RGB_SetColor(RGB_ORANGE3, Bright);
 443   2                              if (_FlagMusic) _FlagMusic=0;
 444   2          }
 445   1          else if((Key==KEY_PURPLE2_MH)||(Key==KEY_PURPLE2))
 446   1          {
 447   2             RGB_DataRam.Effect = 0;
 448   2             RGB_SetColor(RGB_PURPLE2, Bright);
 449   2                              if (_FlagMusic) _FlagMusic=0;
 450   2          }
 451   1          else if((Key==KEY_PURPLE3_MH)||(Key==KEY_PURPLE3))
 452   1          {
 453   2             RGB_DataRam.Effect = 0;
 454   2             RGB_SetColor(RGB_PURPLE3, Bright);
 455   2                              if (_FlagMusic) _FlagMusic=0;
 456   2          }
 457   1          else if((Key==KEY_BLUE3_MH)||(Key==KEY_BLUE3))
 458   1          {
 459   2             RGB_DataRam.Effect = 0;
 460   2             RGB_SetColor(RGB_BLUE3, Bright);
 461   2                              if (_FlagMusic) _FlagMusic=0;
 462   2          }
 463   1          else if((Key==KEY_BLUE4_MH)||(Key==KEY_BLUE4))
 464   1          {
 465   2             RGB_DataRam.Effect = 0;
 466   2             RGB_SetColor(RGB_BLUE4, Bright);
 467   2                              if (_FlagMusic) _FlagMusic=0;
 468   2          }
 469   1          /*else if(Key==KEY_AUTO_MH)
 470   1          {
 471   1              RGB_DataRam.AutoEffect = 5; //auto 5 Random
 472   1              j = m = 0;
 473   1              i = (rand()%7)+1;
 474   1              while(i == RGB_DataRam.Effect)
 475   1              { //Chon gia tri Random khac gia tri cu
 476   1                  i = (rand()%7)+1;
 477   1              }
 478   1              RGB_DataRam.Effect = i;
 479   1              i=0;
 480   1              RGB_DataRom.LastEffect = RGB_DataRam.LastEffect = 2;
 481   1              RGB_DataRom.AutoEffect = RGB_DataRam.AutoEffect;
 482   1              RGB_DataRom.Effect = RGB_DataRam.Effect;
 483   1              RGB_SetColor(RGB_BLACK, Bright);
 484   1          }*/
 485   1          else if((Key==KEY_FLASH_MH)||(Key==KEY_FLASH))
 486   1          {
 487   2              if(RGB_DataRam.LastEffect == 2)
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 9   

 488   2              {
 489   3                   RGB_DataRam.Effect = RGB_DataRam.SaveEffect;
 490   3              }
 491   2              else
 492   2              {
 493   3                  if(++RGB_DataRam.Effect > 7)RGB_DataRam.Effect = 1;
 494   3                  RGB_DataRam.SaveEffect = RGB_DataRam.Effect;
 495   3              }
 496   2                                              RGB_DataRam.LastEffect = 1;
 497   2                                              RGB_DataRam.AutoEffect = 0;
 498   2                                              i = j = m = 0;
 499   2                                              RGB_SetColor(RGB_BLACK, Bright);
 500   2                                              SAVEDATA();
 501   2          }
 502   1          else if((Key==KEY_STROBE_MH)||(Key==KEY_STROBE))
 503   1          {
 504   2              SetProcessAutoEffect(1);  //auto 1
 505   2          }
 506   1       /*   else if((Key==KEY_JUMP7)||(Key==KEY_JUMP7_MH))
 507   1          {
 508   1              SetProcessAutoEffect(2);  //auto 2
 509   1          }
 510   1          else if((Key==KEY_FADE3)||(Key==KEY_FADE3_MH))
 511   1          {
 512   1              SetProcessAutoEffect(3);  //auto 3
 513   1          }
 514   1          else if((Key==KEY_FADE7)||(Key==KEY_FADE7_MH))
 515   1          {
 516   1              SetProcessAutoEffect(4);  //auto 4
 517   1          }*/
 518   1          
 519   1        else if((Key==KEY_UP_MH)||(Key==KEY_UP))  //UP Bright)
 520   1          {
 521   2                      if (RGB_DataRam.Effect == 0)
 522   2                              {
 523   3              if(RGB_DataRam.Brightness < MAX_BRIGHTNESS)
 524   3              {
 525   4                   RGB_DataRam.Brightness++;
 526   4                   if(!RGB_DataRam.Effect)
 527   4                      RGB_SetBright(RGB_DataRam.Brightness);
 528   4              }
 529   3                              }
 530   2                              else
 531   2                              {
 532   3                                       if(RGB_DataRam.Speed < MAX_SPEED)
 533   3              {
 534   4                   RGB_DataRam.Speed++;
 535   4                   RGB_SetSpeed(RGB_DataRam.Speed);
 536   4              }
 537   3                              }
 538   2                              SAVEDATA();
 539   2                                      
 540   2          }
 541   1          else if((Key==KEY_DOWN_MH)||(Key==KEY_DOWN))  //DOWN Bright
 542   1          {
 543   2                              if (RGB_DataRam.Effect == 0)
 544   2                              {
 545   3              if(RGB_DataRam.Brightness > MIN_BRIGHTNESS)
 546   3              {
 547   4                   RGB_DataRam.Brightness--;
 548   4                   if(!RGB_DataRam.Effect)
 549   4                      RGB_SetBright(RGB_DataRam.Brightness);
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 10  

 550   4              }
 551   3                              }
 552   2                              else
 553   2                              {
 554   3                                      if(RGB_DataRam.Speed > MIN_SPEED)
 555   3              {
 556   4                   RGB_DataRam.Speed--;
 557   4                   RGB_SetSpeed(RGB_DataRam.Speed);
 558   4              }
 559   3                              }
 560   2                              SAVEDATA();
 561   2                                      
 562   2          }
 563   1          else if((Key == KEY_SPEED_U)||(Key == KEY_SPEED_U_MH))
 564   1          {
 565   2                                      if (RGB_DataRam.Effect!=0)
 566   2                                              {
 567   3                                               RGB_DataRam.Effect = 0;
 568   3                                               RGB_SetColor(RGB_RED, Bright);
 569   3                                               if (_FlagMusic) _FlagMusic=0;
 570   3                                               if (_FlagFade==0)_FlagFade=1;
 571   3                                               if(_FlagFade == 1) 
 572   3                                                       RGB_DataRam.AutoEffect=8;
 573   3                                               else
 574   3                                                       RGB_DataRam.AutoEffect=0;
 575   3                                              }
 576   2                                              else
 577   2                                              {
 578   3                                               if (++_FlagFade>=2)
 579   3                                                       _FlagFade=0;
 580   3                                               if(_FlagFade == 1) 
 581   3                                                       RGB_DataRam.AutoEffect=8;
 582   3                                               else
 583   3                                                       RGB_DataRam.AutoEffect=0;
 584   3                                               if (_FlagFade==0)
 585   3                                                      RGB_SetBright(RGB_DataRam.Brightness);
 586   3                                              }
 587   2            SAVEDATA();
 588   2          }
 589   1          else if((Key == KEY_SPEED_D)||(Key == KEY_SPEED_D_MH))
 590   1          {
 591   2                              if (++Flag_Music>=2)
 592   2                                              Flag_Music=0;
 593   2                                      if (Flag_Music==0)
 594   2                      RGB_DataRam.AutoEffect = 7;
 595   2                                      if (Flag_Music==1) 
 596   2                                      {
 597   3                                              if (_FlagMusic)
 598   3                                              _FlagMusic=0;
 599   3                                              RGB_DataRam.AutoEffect = 6;
 600   3                                      }
 601   2                                      RGB_DataRam.LastEffect = 2;
 602   2              RGB_DataRam.Effect = 10;
 603   2              i = j = m = 0;
 604   2              RGB_SetColor(RGB_BLACK, RGB_DataRam.Brightness);
 605   2                                      SAVEDATA();
 606   2          }
 607   1      }
 608          void Program_AutoEffect(uint8_t Auto_Effect)
 609          {
 610   1          if(Auto_Effect < 5 && Auto_Effect > 0)
 611   1          {
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 11  

 612   2              if(Run_Effect_Done == 1)
 613   2              {
 614   3                  Run_Effect_Done = 0; //Clear Flag
 615   3                  RGB_DataRam.Effect = Prog_Auto[Auto_Effect-1][m]; //Chuyen chuong trinh
 616   3                  //RGB_DataRom.Effect = RGB_DataRam.Effect;
 617   3                  if(++m > 6)m=0;
 618   3              }
 619   2          }
 620   1          else if(Auto_Effect == 5)    //Auto Random
 621   1          {
 622   2              if(Run_Effect_Done == 1)
 623   2              {
 624   3                  Run_Effect_Done = 0; //Clear Flag
 625   3                  i = j = m = k = 0; //Reset all count
 626   3                  RGB_DataRam.Effect = rand()%7+1; 
 627   3                  //RGB_DataRom.Effect = RGB_DataRam.Effect;
 628   3              }
 629   2          }
 630   1      }
 631          void Program_Effect(uint8_t Prog_Effect, uint8_t Bright)
 632          {
 633   1              if(Prog_Effect==1) //Program Effect 1
 634   1              {  // Doi mau luan chuyen 3 mau
 635   2      //            RGB_SetModeSpeed(7);
 636   2                      RGB_SetModeSpeed(12);
 637   2                              if(++j>2)
 638   2                  {  //i = Lap hieu ung
 639   3                      j=0;
 640   3                      if(++i>7)
 641   3                                                                      { 
 642   4                                                                              i=0;
 643   4                                                                              Run_Effect_Done = 1; 
 644   4                                                                      } //Done Effect
 645   3                  }
 646   2                              if(j==0)
 647   2                  {
 648   3                                      RGB_SetColor(RGB_RED, Bright);
 649   3                  }
 650   2                              else if(j==1)
 651   2                  {
 652   3                                      RGB_SetColor(RGB_GREEN, Bright);
 653   3                  }
 654   2                              else if(j==2)
 655   2                  {
 656   3                                      RGB_SetColor(RGB_BLUE, Bright);
 657   3                  }
 658   2              }//end E1
 659   1              else if(Prog_Effect==2) //Program Effect 2
 660   1              {  // Toi dan luan chuyen 3 mau
 661   2                  //RGB_SetModeSpeed(0x02);
 662   2      //                      RGB_SetModeSpeed(0);
 663   2                      RGB_SetModeSpeed(1);
 664   2                              if(++j>MAX_STEP)
 665   2                              {
 666   3                                      j=0;
 667   3                                      if(++i>2){ i=0; if(++k>4){k=0; Run_Effect_Done = 1;} } //Done Effect
 668   3                      }
 669   2                              if(i==0)
 670   2                              {
 671   3                      SetColor(RED, MAX_STEP-j, Bright);
 672   3                              }
 673   2                              else if(i==1)
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 12  

 674   2                              {
 675   3                      SetColor(GREEN, MAX_STEP-j, Bright);
 676   3                              }
 677   2                              else if(i==2)
 678   2                              {
 679   3                      SetColor(BLUE, MAX_STEP-j, Bright);
 680   3                              }
 681   2              }//end E2
 682   1              else if(Prog_Effect==3) //Program Effect 3
 683   1              {  // Doi mau luan chuyen 7 mau
 684   2                 // RGB_SetModeSpeed(0x09);
 685   2      //                      RGB_SetModeSpeed(7);
 686   2                      RGB_SetModeSpeed(12);
 687   2                              if(++i>6)
 688   2                  {
 689   3                      i=0;
 690   3                      if(++j>14)
 691   3                      {
 692   4                          j=0;
 693   4                          Run_Effect_Done = 1;  //Done Effect
 694   4                      }
 695   3                  }
 696   2                  RGB_SetColor(ColorTable[i], Bright);
 697   2              }//end E3
 698   1              else if(Prog_Effect==4) //Program Effect 4
 699   1              {  // Toi dan luan chuyen 7 mau
 700   2                  //RGB_SetModeSpeed(0x02);
 701   2      //                      RGB_SetModeSpeed(0);
 702   2                      RGB_SetModeSpeed(1);
 703   2                              if(++j>MAX_STEP)
 704   2                              {
 705   3                                      j=0;
 706   3                                      if(++i>6){ i=0; Run_Effect_Done = 1; } //Done Effect
 707   3                              }
 708   2                              if(i==0)
 709   2                              {
 710   3                      SetColor(GREEN, MAX_STEP-j, Bright);
 711   3                              }
 712   2                              else if(i==1)
 713   2                              {
 714   3                                                                      SetColor(RED, MAX_STEP-j, Bright);
 715   3                     
 716   3                              }
 717   2                              else if(i==2)
 718   2                              {
 719   3                      SetColor(BLUE, MAX_STEP-j, Bright);
 720   3                              }
 721   2                              else if(i==3)
 722   2                              {
 723   3                      SetColor(RED, MAX_STEP-j, Bright);
 724   3                      SetColor(GREEN, (MAX_STEP-j)/2, Bright);
 725   3                              }
 726   2                              else if(i==4)
 727   2                              {
 728   3                      SetColor(BLUE, MAX_STEP-j, Bright);
 729   3                      SetColor(GREEN, MAX_STEP-j, Bright);
 730   3                              }
 731   2                              else if(i==5)
 732   2                              {
 733   3                      SetColor(RED, MAX_STEP-j, Bright);
 734   3                      SetColor(BLUE, (MAX_STEP-j)/2, Bright);
 735   3                              }
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 13  

 736   2                              else if(i==6)
 737   2                              {
 738   3                      SetColor(RED, MAX_STEP-j, Bright);
 739   3                      SetColor(GREEN, MAX_STEP-j, Bright);
 740   3                      SetColor(BLUE, MAX_STEP-j, Bright);
 741   3                              }
 742   2              } //end E4
 743   1              else if(Prog_Effect==5) //Program Effect 5
 744   1              {  // Sang Toi dan luan chuyen 7 mau
 745   2                  //RGB_SetModeSpeed(0x02);
 746   2      //                                      RGB_SetModeSpeed(0);
 747   2                      RGB_SetModeSpeed(1);
 748   2                              if(++j>MAX_STEP)
 749   2                              {
 750   3                                      j=0;
 751   3                                      if(++i>13){ i=0; Run_Effect_Done = 1; } //Done Effect
 752   3                              }
 753   2                              if(i==0)
 754   2                                      SetColor(BLUE, MAX_STEP-j, Bright);
 755   2                              else if(i==1)
 756   2                                      SetColor(RED, MAX_STEP-j, Bright);
 757   2                              else if(i==2)
 758   2                                      SetColor(GREEN, j, Bright);
 759   2                              else if(i==3)
 760   2                                      SetColor(GREEN, MAX_STEP-j, Bright);
 761   2                              else if(i==4)
 762   2                                      SetColor(BLUE, j, Bright);
 763   2                              else if(i==5)
 764   2                                      SetColor(RED, j, Bright);
 765   2                              else if(i==6)
 766   2                              {
 767   3                      SetColor(RED, j, Bright);
 768   3                      SetColor(GREEN, j/2, Bright);
 769   3                              }
 770   2                              else if(i==7)
 771   2                              {
 772   3                      SetColor(RED, MAX_STEP-j, Bright);
 773   3                      SetColor(GREEN, (MAX_STEP-j)/2, Bright);
 774   3                              }
 775   2                              else if(i==8)
 776   2                              {
 777   3                                  SetColor(BLUE, j, Bright);
 778   3                      SetColor(GREEN, j, Bright);
 779   3                              }
 780   2                              else if(i==9)
 781   2                              {
 782   3                      SetColor(BLUE, MAX_STEP-j, Bright);
 783   3                      SetColor(GREEN, MAX_STEP-j, Bright);
 784   3                              }
 785   2                              else if(i==10)
 786   2                              {
 787   3                      SetColor(BLUE, j/2, Bright);
 788   3                      SetColor(RED, j, Bright);
 789   3                              }
 790   2                              else if(i==11)
 791   2                              {
 792   3                      SetColor(BLUE, (MAX_STEP-j)/2, Bright);
 793   3                      SetColor(RED, MAX_STEP-j, Bright);
 794   3                              }
 795   2                              else if(i==12)
 796   2                              {
 797   3                                  SetColor(RED, j, Bright);
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 14  

 798   3                      SetColor(GREEN, j, Bright);
 799   3                      SetColor(BLUE, j, Bright);
 800   3                              }
 801   2                              else if(i==13)
 802   2                              {
 803   3                                      SetColor(RED, MAX_STEP-j, Bright);
 804   3                      SetColor(GREEN, MAX_STEP-j, Bright);
 805   3                      SetColor(BLUE, MAX_STEP-j, Bright);
 806   3                              }
 807   2              }//end E5
 808   1              else if(Prog_Effect==6) //Program Effect 6
 809   1          {    //Loan 7 mau
 810   2              //RGB_SetModeSpeed(0x03);
 811   2                                      RGB_SetModeSpeed(12);
 812   2                      if(++j>MAX_STEP)
 813   2                      {
 814   3                              j=0;
 815   3                              if(++i>6){ i=0; Run_Effect_Done = 1; } //Done Effect
 816   3                      }
 817   2                      if(i==0)
 818   2                      {
 819   3                      
 820   3                  RedGreenBlue[RED].Duty =  MAX_STEP;
 821   3                  RedGreenBlue[GREEN].Duty = j;
 822   3                  RedGreenBlue[BLUE].Duty = 0;
 823   3                      }
 824   2                      else if(i==1)
 825   2                      {
 826   3                              RedGreenBlue[RED].Duty =  MAX_STEP-j;
 827   3                  RedGreenBlue[GREEN].Duty = MAX_STEP;
 828   3                  RedGreenBlue[BLUE].Duty = 0;
 829   3                      }
 830   2                      else if(i==2)
 831   2                      {
 832   3                              RedGreenBlue[RED].Duty =  0;
 833   3                  RedGreenBlue[GREEN].Duty = MAX_STEP;
 834   3                  RedGreenBlue[BLUE].Duty = j;
 835   3                      }
 836   2              else if(i==3)
 837   2                      {
 838   3                              RedGreenBlue[RED].Duty =  0;
 839   3                  RedGreenBlue[GREEN].Duty = MAX_STEP-j;
 840   3                  RedGreenBlue[BLUE].Duty = MAX_STEP;
 841   3                      }
 842   2                      else if(i==4)
 843   2                      {
 844   3                  RedGreenBlue[RED].Duty =  j;
 845   3                  RedGreenBlue[GREEN].Duty = 0;
 846   3                  RedGreenBlue[BLUE].Duty = MAX_STEP;
 847   3                      }
 848   2              else if(i==5)
 849   2                      {
 850   3                              RedGreenBlue[RED].Duty =  MAX_STEP;
 851   3                  RedGreenBlue[GREEN].Duty = 0;
 852   3                  RedGreenBlue[BLUE].Duty = MAX_STEP-j;
 853   3                      }
 854   2              }//end E6
 855   1          else if(Prog_Effect==7) //Program Effect 7
 856   1              {  // Bat tat 6 lan tung mau trong 7 mau
 857   2      //        RGB_SetModeSpeed(0x05);
 858   2                      RGB_SetModeSpeed(12);
 859   2              if(++k>1)
C51 COMPILER V9.01   EFFECT                                                                12/18/2025 08:45:26 PAGE 15  

 860   2              {   //k = on/off
 861   3                  k=0;
 862   3                  if(++j>5)
 863   3                  {  //j = lan chop
 864   4                      j=0;
 865   4                      if(++i>6){ i=0; Run_Effect_Done = 1; } //i = sang so mau, Done Effect
 866   4                  }
 867   3              }
 868   2              if(k == 1)RGB_SetColor(ColorTable[i], Bright); //ON COLOR
 869   2              else RGB_SetColor(RGB_BLACK, Bright); //OFF COLOR
 870   2          }//end E7
 871   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   5028    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     79      18
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =      1    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
