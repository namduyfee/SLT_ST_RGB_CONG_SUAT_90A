C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE EFFECT
OBJECT MODULE PLACED IN Effect.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Project\Source\Effect.c LARGE ROM(COMPACT) OPTIMIZE(SIZE) BROWSE NOAREGS IN
                    -CDIR(.\Project\include) DEBUG OBJECTEXTEND PRINT(.\Effect.lst) OBJECT(Effect.obj)

line level    source

   1          #include "Effect.h"
   2          #include "savedata.h"
   3          #include "stdlib.h"
   4          #include "Effect_RGBDance.h"
   5          #include "Debug.H"
   6          #include <stdio.h>
   7          RGB_PIN  RedGreenBlue[3];
   8          extern uint8_t idata ADC_Value;
   9          uint8_t Delay_Music_MONO=10;
  10          extern RGB_DATA RGB_DataRam;
  11          const uint32_t xdata ColorTable[7] = {RGB_RED, RGB_GREEN, RGB_BLUE, RGB_YELLOW, RGB_CYAN, RGB_PURPLE, RGB_
             -WHITE};
  12          extern uint32_t xdata i,j;
  13          extern uint8_t idata Run_Effect_Done;
  14          static  uint8_t xdata k=0, m=0, Flag_Button =0,Flag_Music=0,__Flag_mode=0;
  15          static uint16_t xdata  t=0;
  16          static uint8_t xdata _dBLast = 0;
  17          extern uint8_t xdata _FlagMusic,_FlagFade;
  18          static const uint8_t xdata chu_so[10] = {0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90};
  19          extern uint8_t Effect_Time4;
  20          extern uint8_t xdata u8TH1_Tmp,u8TL1_Tmp;
  21          uint8_t idata But_Count = 0;
  22          static const uint8_t xdata Prog_Auto[4][7] =
  23          {  //Chuong trinh hieu ung cho cac che do auto khac nhau
  24                 1, 2, 3, 4, 5, 6,7,    //Auto 1
  25                 3, 5, 3, 5, 3, 5,3,    //Auto 2
  26                 6, 3, 5, 6, 3, 5,6,    //Auto 3
  27                 7, 5, 6, 7, 5, 6,7,    //Auto 4
  28          };
  29          extern uint8_t xdata DataSave[11];
  30          void RGB_PinInit(void)
  31          {
  32   1          RedGreenBlue[0].Duty      = 0;
  33   1          RedGreenBlue[1].Duty      = 0;
  34   1          RedGreenBlue[2].Duty      = 0;
  35   1      }
  36          uint8_t Audio_Convert(uint8_t ADC_Value_In)
  37          {
  38   1          uint8_t _dBData;
  39   1          _dBData = ((ADC_Value_In/value)*2);
  40   1      //              if(_dBData >254)
  41   1      //                      _dBData = 255;
  42   1          if(_dBData > _dBLast)
  43   1                      {
  44   2                               Effect_Time4 = 0;
  45   2                               _dBLast = _dBData;
  46   2          }
  47   1                      else
  48   1                      {
  49   2                               if(Effect_Time4>Delay_Music_MONO)
  50   2                                      {
  51   3                                              Effect_Time4 = 0;
  52   3                                              if(_dBLast > _dBData)_dBLast--;  //Lam muot khi bien do giam
  53   3                                      }
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 2   

  54   2          }
  55   1          return _dBLast;
  56   1      }
  57           uint8_t LastMode = 0xff;
  58          void RGB_SetModeSpeed(uint8_t Mode)
  59          {
  60   1              if(LastMode!=Mode)
  61   1              {
  62   2                      TR1 = 0;
  63   2                      if(Mode == 1)
  64   2                              T2MOD |= (bTMR_CLK | bT1_CLK);
  65   2                      else if(Mode == 4)
  66   2                      {
  67   3                              T2MOD |= bT1_CLK;
  68   3                              T2MOD &= ~bTMR_CLK;
  69   3                      }
  70   2                      else
  71   2                              T2MOD &= ~bT1_CLK;
  72   2                      TR1 = 1;
  73   2                      LastMode = Mode;
  74   2              }
  75   1      //    if(Mode < 8)
  76   1      //    {
  77   1      //        T3CON &= ~0x07; T3CON |= Mode&0x07;   //Bo chia tan
  78   1      //    }
  79   1      }
  80          void RGB_SetSpeed(uint8_t Speed)
  81          {
  82   1          uint16_t Temp;
  83   1          if(Speed < MIN_SPEED || Speed > MAX_SPEED)return;
  84   1          TR1 = 0;
  85   1          Temp = VALUE_TEMP*((MAX_SPEED+1)-Speed);
  86   1                      u8TH1_Tmp = (65536-Temp)/256;
  87   1                      u8TL1_Tmp = (65536-Temp)%256;  
  88   1                      TH1 = u8TH1_Tmp;
  89   1                      TL1 = u8TL1_Tmp;  
  90   1          ET1 = 1;           //Cau hinh ngat
  91   1          TR1 = 1;
  92   1      }
  93          void RGB_SetBright(uint8_t Brightness)
  94          {
  95   1          RedGreenBlue[RED].Duty = (uint16_t)(RGB_DataRam.Color.DutyRed * Brightness) / MAX_BRIGHTNESS;
  96   1          RedGreenBlue[GREEN].Duty = (uint16_t)(RGB_DataRam.Color.DutyGreen * Brightness) / MAX_BRIGHTNESS;
  97   1          RedGreenBlue[BLUE].Duty = (uint16_t)(RGB_DataRam.Color.DutyBlue * Brightness) / MAX_BRIGHTNESS;
  98   1      
  99   1      }
 100          void RGB_SetColor(uint32_t Color, uint8_t Brightness)
 101          {
 102   1          RGB_DataRam.Color.DutyRed = (uint8_t)(Color>>16);
 103   1          RGB_DataRam.Color.DutyGreen = (uint8_t)(Color>>8);
 104   1          RGB_DataRam.Color.DutyBlue = (uint8_t)(Color);
 105   1          if(RGB_DataRam.Effect == 0)
 106   1          {
 107   2      
 108   2                      SAVEDATA();
 109   2          }
 110   1          RGB_SetBright(Brightness);
 111   1      }
 112          void SetColor(uint8_t color, uint8_t duty, uint8_t bright)
 113          {
 114   1          if(color == RED)RGB_DataRam.Color.DutyRed = duty;
 115   1          else if(color == GREEN)RGB_DataRam.Color.DutyGreen = duty;
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 3   

 116   1          else if(color == BLUE)RGB_DataRam.Color.DutyBlue = duty;
 117   1          else return;
 118   1                      if(!_FlagMusic)
 119   1                              RedGreenBlue[color].Duty = (uint16_t)(duty * bright) / MAX_BRIGHTNESS;
 120   1                      else
 121   1                              RedGreenBlue[color].Duty = duty;//(uint16_t)(duty * bright) / MAX_BRIGHTNESS;
 122   1      }
 123          void LED7_OutData(uint8_t Data)
 124          {
 125   1        LED7_DATA_A  =  ((Data&0x01)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 126   1        LED7_DATA_B  =  ((Data&0x02)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 127   1        LED7_DATA_C  =  ((Data&0x04)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 128   1        LED7_DATA_D  =  ((Data&0x08)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 129   1        LED7_DATA_E  =  ((Data&0x10)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 130   1        LED7_DATA_F  =  ((Data&0x20)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 131   1        LED7_DATA_G  =  ((Data&0x40)!=0)?LED7_DATA_ON:LED7_DATA_OFF;
 132   1      }
 133          void Display_LED_7(uint8_t Num)
 134          {
 135   1          if(Num > 9)return;
 136   1          LED7_OutData(chu_so[Num]);
 137   1      }
 138          void RGB_OnDisplay(void)
 139          {
 140   1          TR0 = 1;
 141   1      }
 142          void RGB_OffDisplay(void)
 143          {
 144   1          TR0 = 0;
 145   1                      GPIO_RED_OFF();
 146   1                      GPIO_GREEN_OFF();
 147   1                      GPIO_BLUE_OFF();
 148   1      }
 149          void SetProcessAutoEffect(uint8_t AutoEffect)    //Save  o day
 150          {
 151   1           RGB_DataRam.LastEffect = 2;
 152   1           RGB_DataRam.AutoEffect = AutoEffect;
 153   1           RGB_DataRam.Effect = Prog_Auto[AutoEffect-1][0];
 154   1      //     RGB_DataRom.AutoEffect = RGB_DataRam.AutoEffect;
 155   1      //     RGB_DataRom.Effect = RGB_DataRam.Effect;
 156   1                       //IAP_AP_Erase_Pages(17920,1);
 157   1                       SAVEDATA();
 158   1           i = j = m = 0;
 159   1           RGB_SetColor(RGB_BLACK, RGB_DataRam.Brightness);
 160   1      }
 161          FLAG_KEY KEY_GetKey (void)
 162          {
 163   1              uint8_t i=0;
 164   1              if (RGB_DataRam.Flags)
 165   1              {
 166   2                      if ((BUT_DON_DA==0)&&(BUT_SPEED!=0)&&(BUT_MUSIC!=0))
 167   2                      {
 168   3                              mDelaymS(40);
 169   3                              if ((BUT_DON_DA==0)&&(BUT_SPEED!=0)&&(BUT_MUSIC!=0))
 170   3                                      return __KEY_FLASH;
 171   3      //                      {
 172   3      //                              for (i=0;i<50;i++)
 173   3      //                              {
 174   3      //                               if (!((BUT_DON_DA==0)&&(BUT_SPEED!=0)&&(BUT_MUSIC!=0)))
 175   3      //                                       break;
 176   3      //                               mDelaymS(10);
 177   3      //                              }
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 4   

 178   3      //                      }
 179   3      //                      if (i>=50) return __KEY_FLASH_LONG;
 180   3      //              else return __KEY_FLASH;
 181   3                      }
 182   2      
 183   2                      else if ((BUT_DON_DA!=0)&&(BUT_SPEED==0)&&(BUT_MUSIC!=0))
 184   2                      {
 185   3                              mDelaymS(40);
 186   3                              if ((BUT_DON_DA!=0)&&(BUT_SPEED==0)&&(BUT_MUSIC!=0))
 187   3                                      return __KEY_SPEED;
 188   3      //                      {
 189   3      //                              for (i=0;i<50;i++)
 190   3      //                              {
 191   3      //                               if (!((BUT_DON_DA!=0)&&(BUT_SPEED==0)&&(BUT_MUSIC!=0)))
 192   3      //                                       break;
 193   3      //                               mDelaymS(10);
 194   3      //                              }
 195   3      //                      }
 196   3      //                      if (i>=50) return __NO_KEY;
 197   3      //                      else return __KEY_SPEED;
 198   3                      }
 199   2                      else if ((BUT_DON_DA!=0)&&(BUT_SPEED!=0)&&(BUT_MUSIC==0))
 200   2                      {
 201   3                              mDelaymS(40);
 202   3                              if ((BUT_DON_DA!=0)&&(BUT_SPEED!=0)&&(BUT_MUSIC==0))
 203   3                                      return __KEY_MUSIC;
 204   3      //                      {
 205   3      //                              for (i=0;i<50;i++)
 206   3      //                              {
 207   3      //                               if (!((BUT_DON_DA!=0)&&(BUT_SPEED!=0)&&(BUT_MUSIC==0)))
 208   3      //                                       break;
 209   3      //                               mDelaymS(10);
 210   3      //                              }
 211   3      //                      }
 212   3      //                      if (i>=50) return __NO_KEY;
 213   3      //                      else return __KEY_MUSIC;
 214   3                      }
 215   2              }
 216   1              return __NO_KEY;
 217   1      }
 218          void Check_Button(uint8_t Bright)                                                                       // han nay chua xu ly
 219          {
 220   1              uint8_t Key=KEY_GetKey();
 221   1              switch (Key)
 222   1              {
 223   2          case __KEY_FLASH:
 224   2          {
 225   3                              But_Count++;
 226   3                              if(But_Count >= 7) //DA
 227   3                              {
 228   4                                      if (_FlagMusic) _FlagMusic=0;
 229   4              if(RGB_DataRam.AutoEffect==6)
 230   4               RGB_OnDisplay();
 231   4              if(RGB_DataRam.LastEffect == 2)
 232   4                RGB_DataRam.Effect = RGB_DataRam.SaveEffect;
 233   4                      else
 234   4              {
 235   5                                              if(++RGB_DataRam.Effect > 7)
 236   5                                              {
 237   6                                                      But_Count = 0;
 238   6                                                      RGB_DataRam.Effect = 1;
 239   6                                              }
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 5   

 240   5                                                      RGB_DataRam.SaveEffect = RGB_DataRam.Effect;
 241   5              }
 242   4              RGB_DataRam.LastEffect = 1;
 243   4              RGB_DataRam.AutoEffect = 0;
 244   4              i = j = m = 0;
 245   4              RGB_SetColor(RGB_BLACK, RGB_DataRam.Brightness);
 246   4                                      SAVEDATA();
 247   4                              }
 248   3                              if(But_Count < 7) //DON
 249   3                              {
 250   4                                      if (RGB_DataRam.Effect == 10)
 251   4                                      {
 252   5                                              Delay_Music_MONO=20;
 253   5                                              RGB_DataRam.Effect = 0;
 254   5                                              //if (_FlagFade==0)_FlagFade=1;
 255   5                                              if(RGB_DataRam.AutoEffect==6)
 256   5                              RGB_OnDisplay();
 257   5                if(++k>6)k=0;
 258   5                              RGB_SetColor(ColorTable[k],Bright);
 259   5                                              if(_FlagFade == 1) 
 260   5                                                      RGB_DataRam.AutoEffect=8;
 261   5                                              else
 262   5                                                      RGB_DataRam.AutoEffect=0;
 263   5                                      }
 264   4                                      else
 265   4                                      {
 266   5                                              RGB_DataRam.Effect = 0;
 267   5                                              if(RGB_DataRam.AutoEffect==6)
 268   5                              RGB_OnDisplay();
 269   5                if(++k>6)k=0;
 270   5                              RGB_SetColor(ColorTable[k],RGB_DataRam.Brightness);
 271   5                                              if(_FlagFade == 1) 
 272   5                                                      RGB_DataRam.AutoEffect=8;
 273   5                                              else
 274   5                                                      RGB_DataRam.AutoEffect=0;
 275   5                                      }
 276   4                                      SAVEDATA();
 277   4                              }
 278   3                              break;
 279   3                      }
 280   2      //    case __KEY_MONO:
 281   2      //    {
 282   2      //                              if (RGB_DataRam.Effect == 10)
 283   2      //                              {
 284   2      //                                      Delay_Music_MONO=20;
 285   2      //                                      RGB_DataRam.Effect = 0;
 286   2      //                                      //if (_FlagFade==0)_FlagFade=1;
 287   2      //                                      if(RGB_DataRam.AutoEffect==6)
 288   2      //                      RGB_OnDisplay();
 289   2      //                if(++k>6)k=0;
 290   2      //                              RGB_SetColor(ColorTable[k],Bright);
 291   2      //                                      if(_FlagFade == 1) 
 292   2      //                                              RGB_DataRam.AutoEffect=8;
 293   2      //                                      else
 294   2      //                                              RGB_DataRam.AutoEffect=0;
 295   2      //                              }
 296   2      //                              else
 297   2      //                              {
 298   2      //                                      RGB_DataRam.Effect = 0;
 299   2      //                                      if(RGB_DataRam.AutoEffect==6)
 300   2      //                      RGB_OnDisplay();
 301   2      //                if(++k>6)k=0;
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 6   

 302   2      //                              RGB_SetColor(ColorTable[k],RGB_DataRam.Brightness);
 303   2      //                                      if(_FlagFade == 1) 
 304   2      //                                              RGB_DataRam.AutoEffect=8;
 305   2      //                                      else
 306   2      //                                              RGB_DataRam.AutoEffect=0;
 307   2      //                              }
 308   2      //                              SAVEDATA();
 309   2      //                              break;
 310   2      //    }
 311   2                      case __KEY_MONO_LONG:
 312   2          {
 313   3                              
 314   3                                      _FlagFade = !_FlagFade;
 315   3                                      if(_FlagFade == 1) 
 316   3                                              RGB_DataRam.AutoEffect=8;
 317   3                                      else
 318   3                                              RGB_DataRam.AutoEffect=0;                       
 319   3                                      RGB_SetColor(RGB_RED,RGB_DataRam.Brightness);
 320   3                                      SAVEDATA();
 321   3                              break;
 322   3                      }
 323   2          case __KEY_MUSIC:
 324   2          {
 325   3                              if (++__Flag_mode>=2)
 326   3                                      __Flag_mode=0;
 327   3                              if (__Flag_mode==1)
 328   3                              {
 329   4      
 330   4              if (_FlagMusic) _FlagMusic=0;
 331   4                      RGB_DataRam.LastEffect = 2;
 332   4                      RGB_DataRam.AutoEffect = 6;
 333   4                      RGB_DataRam.Effect = 10;
 334   4                      i = j = m = 0;
 335   4               RGB_SetColor(RGB_BLACK, RGB_DataRam.Brightness); 
 336   4                              }
 337   3                              else
 338   3                              {
 339   4                                              if (_FlagMusic) _FlagMusic=0;
 340   4                      RGB_DataRam.LastEffect = 2;
 341   4                      RGB_DataRam.AutoEffect = 7;
 342   4                      RGB_DataRam.Effect = 10;
 343   4                      i = j = m = 0;
 344   4               RGB_SetColor(RGB_BLACK, RGB_DataRam.Brightness); 
 345   4                              }
 346   3                              SAVEDATA();
 347   3                              break;
 348   3          }
 349   2          case __KEY_SPEED:
 350   2          {
 351   3             if (RGB_DataRam.Effect == 0)
 352   3             {
 353   4               if(++RGB_DataRam.Brightness > MAX_BRIGHTNESS)
 354   4               {
 355   5                   RGB_DataRam.Brightness = MIN_BRIGHTNESS;
 356   5               }
 357   4               if(!RGB_DataRam.Effect)
 358   4                  RGB_SetBright(RGB_DataRam.Brightness);
 359   4             }
 360   3             else
 361   3             {
 362   4                                       RGB_DataRam.Speed += 2;
 363   4              if(RGB_DataRam.Speed > MAX_SPEED)
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 7   

 364   4              {
 365   5                   RGB_DataRam.Speed = MIN_SPEED;
 366   5              }
 367   4               RGB_SetSpeed(RGB_DataRam.Speed);
 368   4             }
 369   3                              SAVEDATA();
 370   3                              break;
 371   3          }
 372   2              }
 373   1              while ((Key=KEY_GetKey())!=__NO_KEY);
 374   1      }
 375          
 376          void RGB_ProcessKey(uint32_t Key, uint8_t Bright)
 377          {
 378   1        if((Key==KEY_RED_MH)||(Key==KEY_RED))
 379   1          {
 380   2             RGB_DataRam.Effect = 0;
 381   2             RGB_SetColor(RGB_RED, Bright);
 382   2                              if (_FlagMusic) _FlagMusic=0;
 383   2          }
 384   1          else if((Key==KEY_BLUE_MH)||(Key==KEY_BLUE))
 385   1          {
 386   2             RGB_DataRam.Effect = 0;
 387   2             RGB_SetColor(RGB_BLUE, Bright);
 388   2                              if (_FlagMusic) _FlagMusic=0;
 389   2          }
 390   1          else if((Key==KEY_GREEN_MH)||(Key==KEY_GREEN))
 391   1          {
 392   2             RGB_DataRam.Effect = 0;
 393   2             RGB_SetColor(RGB_GREEN, Bright);
 394   2                              if (_FlagMusic) _FlagMusic=0;
 395   2          }
 396   1          else if((Key==KEY_WHITE_MH)||(Key==KEY_WHITE))
 397   1          {
 398   2             RGB_DataRam.Effect = 0;
 399   2             RGB_SetColor(RGB_WHITE, Bright);
 400   2                              if (_FlagMusic) _FlagMusic=0;
 401   2          }
 402   1          else if((Key==KEY_ORANGE_MH)||(Key==KEY_ORANGE))
 403   1          {
 404   2             RGB_DataRam.Effect = 0;
 405   2             RGB_SetColor(RGB_ORANGE, Bright);
 406   2                              if (_FlagMusic) _FlagMusic=0;
 407   2          }
 408   1          else if((Key==KEY_YELLOW_MH)||(Key==KEY_YELLOW))
 409   1          {
 410   2             RGB_DataRam.Effect = 0;
 411   2             RGB_SetColor(RGB_YELLOW, Bright);
 412   2                              if (_FlagMusic) _FlagMusic=0;
 413   2          }
 414   1          else if((Key==KEY_CYAN_MH)||(Key==KEY_CYAN))
 415   1          {
 416   2             RGB_DataRam.Effect = 0;
 417   2             RGB_SetColor(RGB_CYAN, Bright);
 418   2                              if (_FlagMusic) _FlagMusic=0;
 419   2          }
 420   1          else if((Key==KEY_PURPLE_MH)||(Key==KEY_PURPLE))
 421   1          {
 422   2             RGB_DataRam.Effect = 0;
 423   2             RGB_SetColor(RGB_PURPLE, Bright);
 424   2                              if (_FlagMusic) _FlagMusic=0;
 425   2          }
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 8   

 426   1          else if((Key==KEY_GREEN2_MH)||(Key==KEY_GREEN2))
 427   1          {
 428   2             RGB_DataRam.Effect = 0;
 429   2             RGB_SetColor(RGB_GREEN2, Bright);
 430   2                              if (_FlagMusic) _FlagMusic=0;
 431   2          }
 432   1          else if((Key==KEY_BLUE2_MH)||(Key==KEY_BLUE2))
 433   1          {
 434   2             RGB_DataRam.Effect = 0;
 435   2             RGB_SetColor(RGB_BLUE2, Bright);
 436   2                              if (_FlagMusic) _FlagMusic=0;
 437   2          }
 438   1          else if((Key==KEY_ORANGE2_MH)||(Key==KEY_ORANGE2))
 439   1          {
 440   2             RGB_DataRam.Effect = 0;
 441   2             RGB_SetColor(RGB_ORANGE2, Bright);
 442   2                              if (_FlagMusic) _FlagMusic=0;
 443   2          }
 444   1          else if((Key==KEY_ORANGE3_MH)||(Key==KEY_ORANGE3))
 445   1          {
 446   2             RGB_DataRam.Effect = 0;
 447   2             RGB_SetColor(RGB_ORANGE3, Bright);
 448   2                              if (_FlagMusic) _FlagMusic=0;
 449   2          }
 450   1          else if((Key==KEY_PURPLE2_MH)||(Key==KEY_PURPLE2))
 451   1          {
 452   2             RGB_DataRam.Effect = 0;
 453   2             RGB_SetColor(RGB_PURPLE2, Bright);
 454   2                              if (_FlagMusic) _FlagMusic=0;
 455   2          }
 456   1          else if((Key==KEY_PURPLE3_MH)||(Key==KEY_PURPLE3))
 457   1          {
 458   2             RGB_DataRam.Effect = 0;
 459   2             RGB_SetColor(RGB_PURPLE3, Bright);
 460   2                              if (_FlagMusic) _FlagMusic=0;
 461   2          }
 462   1          else if((Key==KEY_BLUE3_MH)||(Key==KEY_BLUE3))
 463   1          {
 464   2             RGB_DataRam.Effect = 0;
 465   2             RGB_SetColor(RGB_BLUE3, Bright);
 466   2                              if (_FlagMusic) _FlagMusic=0;
 467   2          }
 468   1          else if((Key==KEY_BLUE4_MH)||(Key==KEY_BLUE4))
 469   1          {
 470   2             RGB_DataRam.Effect = 0;
 471   2             RGB_SetColor(RGB_BLUE4, Bright);
 472   2                              if (_FlagMusic) _FlagMusic=0;
 473   2          }
 474   1          /*else if(Key==KEY_AUTO_MH)
 475   1          {
 476   1              RGB_DataRam.AutoEffect = 5; //auto 5 Random
 477   1              j = m = 0;
 478   1              i = (rand()%7)+1;
 479   1              while(i == RGB_DataRam.Effect)
 480   1              { //Chon gia tri Random khac gia tri cu
 481   1                  i = (rand()%7)+1;
 482   1              }
 483   1              RGB_DataRam.Effect = i;
 484   1              i=0;
 485   1              RGB_DataRom.LastEffect = RGB_DataRam.LastEffect = 2;
 486   1              RGB_DataRom.AutoEffect = RGB_DataRam.AutoEffect;
 487   1              RGB_DataRom.Effect = RGB_DataRam.Effect;
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 9   

 488   1              RGB_SetColor(RGB_BLACK, Bright);
 489   1          }*/
 490   1          else if((Key==KEY_FLASH_MH)||(Key==KEY_FLASH))
 491   1          {
 492   2              if(RGB_DataRam.LastEffect == 2)
 493   2              {
 494   3                   RGB_DataRam.Effect = RGB_DataRam.SaveEffect;
 495   3              }
 496   2              else
 497   2              {
 498   3                  if(++RGB_DataRam.Effect > 7)RGB_DataRam.Effect = 1;
 499   3                  RGB_DataRam.SaveEffect = RGB_DataRam.Effect;
 500   3              }
 501   2                                              RGB_DataRam.LastEffect = 1;
 502   2                                              RGB_DataRam.AutoEffect = 0;
 503   2                                              i = j = m = 0;
 504   2                                              RGB_SetColor(RGB_BLACK, Bright);
 505   2                                              SAVEDATA();
 506   2          }
 507   1          else if((Key==KEY_STROBE_MH)||(Key==KEY_STROBE))
 508   1          {
 509   2              SetProcessAutoEffect(1);  //auto 1
 510   2          }
 511   1       /*   else if((Key==KEY_JUMP7)||(Key==KEY_JUMP7_MH))
 512   1          {
 513   1              SetProcessAutoEffect(2);  //auto 2
 514   1          }
 515   1          else if((Key==KEY_FADE3)||(Key==KEY_FADE3_MH))
 516   1          {
 517   1              SetProcessAutoEffect(3);  //auto 3
 518   1          }
 519   1          else if((Key==KEY_FADE7)||(Key==KEY_FADE7_MH))
 520   1          {
 521   1              SetProcessAutoEffect(4);  //auto 4
 522   1          }*/
 523   1          
 524   1        else if((Key==KEY_UP_MH)||(Key==KEY_UP))  //UP Bright)
 525   1          {
 526   2                      if (RGB_DataRam.Effect == 0)
 527   2                              {
 528   3              if(RGB_DataRam.Brightness < MAX_BRIGHTNESS)
 529   3              {
 530   4                   RGB_DataRam.Brightness++;
 531   4                   if(!RGB_DataRam.Effect)
 532   4                      RGB_SetBright(RGB_DataRam.Brightness);
 533   4              }
 534   3                              }
 535   2                              else
 536   2                              {
 537   3                                       if(RGB_DataRam.Speed < MAX_SPEED)
 538   3              {
 539   4                   RGB_DataRam.Speed++;
 540   4                   RGB_SetSpeed(RGB_DataRam.Speed);
 541   4              }
 542   3                              }
 543   2                              SAVEDATA();
 544   2                                      
 545   2          }
 546   1          else if((Key==KEY_DOWN_MH)||(Key==KEY_DOWN))  //DOWN Bright
 547   1          {
 548   2                              if (RGB_DataRam.Effect == 0)
 549   2                              {
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 10  

 550   3              if(RGB_DataRam.Brightness > MIN_BRIGHTNESS)
 551   3              {
 552   4                   RGB_DataRam.Brightness--;
 553   4                   if(!RGB_DataRam.Effect)
 554   4                      RGB_SetBright(RGB_DataRam.Brightness);
 555   4              }
 556   3                              }
 557   2                              else
 558   2                              {
 559   3                                      if(RGB_DataRam.Speed > MIN_SPEED)
 560   3              {
 561   4                   RGB_DataRam.Speed--;
 562   4                   RGB_SetSpeed(RGB_DataRam.Speed);
 563   4              }
 564   3                              }
 565   2                              SAVEDATA();
 566   2                                      
 567   2          }
 568   1          else if((Key == KEY_SPEED_U)||(Key == KEY_SPEED_U_MH))
 569   1          {
 570   2                                      if (RGB_DataRam.Effect!=0)
 571   2                                              {
 572   3                                               RGB_DataRam.Effect = 0;
 573   3                                               RGB_SetColor(RGB_RED, Bright);
 574   3                                               if (_FlagMusic) _FlagMusic=0;
 575   3                                               if (_FlagFade==0)_FlagFade=1;
 576   3                                               if(_FlagFade == 1) 
 577   3                                                       RGB_DataRam.AutoEffect=8;
 578   3                                               else
 579   3                                                       RGB_DataRam.AutoEffect=0;
 580   3                                              }
 581   2                                              else
 582   2                                              {
 583   3                                               if (++_FlagFade>=2)
 584   3                                                       _FlagFade=0;
 585   3                                               if(_FlagFade == 1) 
 586   3                                                       RGB_DataRam.AutoEffect=8;
 587   3                                               else
 588   3                                                       RGB_DataRam.AutoEffect=0;
 589   3                                               if (_FlagFade==0)
 590   3                                                      RGB_SetBright(RGB_DataRam.Brightness);
 591   3                                              }
 592   2            SAVEDATA();
 593   2          }
 594   1          else if((Key == KEY_SPEED_D)||(Key == KEY_SPEED_D_MH))
 595   1          {
 596   2                              if (++Flag_Music>=2)
 597   2                                              Flag_Music=0;
 598   2                                      if (Flag_Music==0)
 599   2                      RGB_DataRam.AutoEffect = 7;
 600   2                                      if (Flag_Music==1) 
 601   2                                      {
 602   3                                              if (_FlagMusic)
 603   3                                              _FlagMusic=0;
 604   3                                              RGB_DataRam.AutoEffect = 6;
 605   3                                      }
 606   2                                      RGB_DataRam.LastEffect = 2;
 607   2              RGB_DataRam.Effect = 10;
 608   2              i = j = m = 0;
 609   2              RGB_SetColor(RGB_BLACK, RGB_DataRam.Brightness);
 610   2                                      SAVEDATA();
 611   2          }
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 11  

 612   1      }
 613          void Program_AutoEffect(uint8_t Auto_Effect)
 614          {
 615   1          if(Auto_Effect < 5 && Auto_Effect > 0)
 616   1          {
 617   2              if(Run_Effect_Done == 1)
 618   2              {
 619   3                  Run_Effect_Done = 0; //Clear Flag
 620   3                  RGB_DataRam.Effect = Prog_Auto[Auto_Effect-1][m]; //Chuyen chuong trinh
 621   3                  //RGB_DataRom.Effect = RGB_DataRam.Effect;
 622   3                  if(++m > 6)m=0;
 623   3              }
 624   2          }
 625   1          else if(Auto_Effect == 5)    //Auto Random
 626   1          {
 627   2              if(Run_Effect_Done == 1)
 628   2              {
 629   3                  Run_Effect_Done = 0; //Clear Flag
 630   3                  i = j = m = k = 0; //Reset all count
 631   3                  RGB_DataRam.Effect = rand()%7+1; 
 632   3                  //RGB_DataRom.Effect = RGB_DataRam.Effect;
 633   3              }
 634   2          }
 635   1      }
 636          void Program_Effect(uint8_t Prog_Effect, uint8_t Bright)
 637          {
 638   1              if(Prog_Effect==1) //Program Effect 1
 639   1              {  // Doi mau luan chuyen 3 mau
 640   2      //            RGB_SetModeSpeed(7);
 641   2                      RGB_SetModeSpeed(12);
 642   2                              if(++j>2)
 643   2                  {  //i = Lap hieu ung
 644   3                      j=0;
 645   3                      if(++i>7)
 646   3                                                                      { 
 647   4                                                                              i=0;
 648   4                                                                              Run_Effect_Done = 1; 
 649   4                                                                      } //Done Effect
 650   3                  }
 651   2                              if(j==0)
 652   2                  {
 653   3                                      RGB_SetColor(RGB_RED, Bright);
 654   3                  }
 655   2                              else if(j==1)
 656   2                  {
 657   3                                      RGB_SetColor(RGB_GREEN, Bright);
 658   3                  }
 659   2                              else if(j==2)
 660   2                  {
 661   3                                      RGB_SetColor(RGB_BLUE, Bright);
 662   3                  }
 663   2              }//end E1
 664   1              else if(Prog_Effect==2) //Program Effect 2
 665   1              {  // Toi dan luan chuyen 3 mau
 666   2                  //RGB_SetModeSpeed(0x02);
 667   2      //                      RGB_SetModeSpeed(0);
 668   2                      RGB_SetModeSpeed(1);
 669   2                              if(++j>MAX_STEP)
 670   2                              {
 671   3                                      j=0;
 672   3                                      if(++i>2){ i=0; if(++k>4){k=0; Run_Effect_Done = 1;} } //Done Effect
 673   3                      }
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 12  

 674   2                              if(i==0)
 675   2                              {
 676   3                      SetColor(RED, MAX_STEP-j, Bright);
 677   3                              }
 678   2                              else if(i==1)
 679   2                              {
 680   3                      SetColor(GREEN, MAX_STEP-j, Bright);
 681   3                              }
 682   2                              else if(i==2)
 683   2                              {
 684   3                      SetColor(BLUE, MAX_STEP-j, Bright);
 685   3                              }
 686   2              }//end E2
 687   1              else if(Prog_Effect==3) //Program Effect 3
 688   1              {  // Doi mau luan chuyen 7 mau
 689   2                 // RGB_SetModeSpeed(0x09);
 690   2      //                      RGB_SetModeSpeed(7);
 691   2                      RGB_SetModeSpeed(12);
 692   2                              if(++i>6)
 693   2                  {
 694   3                      i=0;
 695   3                      if(++j>14)
 696   3                      {
 697   4                          j=0;
 698   4                          Run_Effect_Done = 1;  //Done Effect
 699   4                      }
 700   3                  }
 701   2                  RGB_SetColor(ColorTable[i], Bright);
 702   2              }//end E3
 703   1              else if(Prog_Effect==4) //Program Effect 4
 704   1              {  // Toi dan luan chuyen 7 mau
 705   2                  //RGB_SetModeSpeed(0x02);
 706   2      //                      RGB_SetModeSpeed(0);
 707   2                      RGB_SetModeSpeed(1);
 708   2                              if(++j>MAX_STEP)
 709   2                              {
 710   3                                      j=0;
 711   3                                      if(++i>6){ i=0; Run_Effect_Done = 1; } //Done Effect
 712   3                              }
 713   2                              if(i==0)
 714   2                              {
 715   3                      SetColor(GREEN, MAX_STEP-j, Bright);
 716   3                              }
 717   2                              else if(i==1)
 718   2                              {
 719   3                                                                      SetColor(RED, MAX_STEP-j, Bright);
 720   3                     
 721   3                              }
 722   2                              else if(i==2)
 723   2                              {
 724   3                      SetColor(BLUE, MAX_STEP-j, Bright);
 725   3                              }
 726   2                              else if(i==3)
 727   2                              {
 728   3                      SetColor(RED, MAX_STEP-j, Bright);
 729   3                      SetColor(GREEN, (MAX_STEP-j)/2, Bright);
 730   3                              }
 731   2                              else if(i==4)
 732   2                              {
 733   3                      SetColor(BLUE, MAX_STEP-j, Bright);
 734   3                      SetColor(GREEN, MAX_STEP-j, Bright);
 735   3                              }
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 13  

 736   2                              else if(i==5)
 737   2                              {
 738   3                      SetColor(RED, MAX_STEP-j, Bright);
 739   3                      SetColor(BLUE, (MAX_STEP-j)/2, Bright);
 740   3                              }
 741   2                              else if(i==6)
 742   2                              {
 743   3                      SetColor(RED, MAX_STEP-j, Bright);
 744   3                      SetColor(GREEN, MAX_STEP-j, Bright);
 745   3                      SetColor(BLUE, MAX_STEP-j, Bright);
 746   3                              }
 747   2              } //end E4
 748   1              else if(Prog_Effect==5) //Program Effect 5
 749   1              {  // Sang Toi dan luan chuyen 7 mau
 750   2                  //RGB_SetModeSpeed(0x02);
 751   2      //                                      RGB_SetModeSpeed(0);
 752   2                      RGB_SetModeSpeed(1);
 753   2                              if(++j>MAX_STEP)
 754   2                              {
 755   3                                      j=0;
 756   3                                      if(++i>13){ i=0; Run_Effect_Done = 1; } //Done Effect
 757   3                              }
 758   2                              if(i==0)
 759   2                                      SetColor(BLUE, MAX_STEP-j, Bright);
 760   2                              else if(i==1)
 761   2                                      SetColor(RED, MAX_STEP-j, Bright);
 762   2                              else if(i==2)
 763   2                                      SetColor(GREEN, j, Bright);
 764   2                              else if(i==3)
 765   2                                      SetColor(GREEN, MAX_STEP-j, Bright);
 766   2                              else if(i==4)
 767   2                                      SetColor(BLUE, j, Bright);
 768   2                              else if(i==5)
 769   2                                      SetColor(RED, j, Bright);
 770   2                              else if(i==6)
 771   2                              {
 772   3                      SetColor(RED, j, Bright);
 773   3                      SetColor(GREEN, j/2, Bright);
 774   3                              }
 775   2                              else if(i==7)
 776   2                              {
 777   3                      SetColor(RED, MAX_STEP-j, Bright);
 778   3                      SetColor(GREEN, (MAX_STEP-j)/2, Bright);
 779   3                              }
 780   2                              else if(i==8)
 781   2                              {
 782   3                                  SetColor(BLUE, j, Bright);
 783   3                      SetColor(GREEN, j, Bright);
 784   3                              }
 785   2                              else if(i==9)
 786   2                              {
 787   3                      SetColor(BLUE, MAX_STEP-j, Bright);
 788   3                      SetColor(GREEN, MAX_STEP-j, Bright);
 789   3                              }
 790   2                              else if(i==10)
 791   2                              {
 792   3                      SetColor(BLUE, j/2, Bright);
 793   3                      SetColor(RED, j, Bright);
 794   3                              }
 795   2                              else if(i==11)
 796   2                              {
 797   3                      SetColor(BLUE, (MAX_STEP-j)/2, Bright);
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 14  

 798   3                      SetColor(RED, MAX_STEP-j, Bright);
 799   3                              }
 800   2                              else if(i==12)
 801   2                              {
 802   3                                  SetColor(RED, j, Bright);
 803   3                      SetColor(GREEN, j, Bright);
 804   3                      SetColor(BLUE, j, Bright);
 805   3                              }
 806   2                              else if(i==13)
 807   2                              {
 808   3                                      SetColor(RED, MAX_STEP-j, Bright);
 809   3                      SetColor(GREEN, MAX_STEP-j, Bright);
 810   3                      SetColor(BLUE, MAX_STEP-j, Bright);
 811   3                              }
 812   2              }//end E5
 813   1              else if(Prog_Effect==6) //Program Effect 6
 814   1          {    //Loan 7 mau
 815   2              //RGB_SetModeSpeed(0x03);
 816   2                                      RGB_SetModeSpeed(12);
 817   2                      if(++j>MAX_STEP)
 818   2                      {
 819   3                              j=0;
 820   3                              if(++i>6){ i=0; Run_Effect_Done = 1; } //Done Effect
 821   3                      }
 822   2                      if(i==0)
 823   2                      {
 824   3                      
 825   3                  RedGreenBlue[RED].Duty =  MAX_STEP;
 826   3                  RedGreenBlue[GREEN].Duty = j;
 827   3                  RedGreenBlue[BLUE].Duty = 0;
 828   3                      }
 829   2                      else if(i==1)
 830   2                      {
 831   3                              RedGreenBlue[RED].Duty =  MAX_STEP-j;
 832   3                  RedGreenBlue[GREEN].Duty = MAX_STEP;
 833   3                  RedGreenBlue[BLUE].Duty = 0;
 834   3                      }
 835   2                      else if(i==2)
 836   2                      {
 837   3                              RedGreenBlue[RED].Duty =  0;
 838   3                  RedGreenBlue[GREEN].Duty = MAX_STEP;
 839   3                  RedGreenBlue[BLUE].Duty = j;
 840   3                      }
 841   2              else if(i==3)
 842   2                      {
 843   3                              RedGreenBlue[RED].Duty =  0;
 844   3                  RedGreenBlue[GREEN].Duty = MAX_STEP-j;
 845   3                  RedGreenBlue[BLUE].Duty = MAX_STEP;
 846   3                      }
 847   2                      else if(i==4)
 848   2                      {
 849   3                  RedGreenBlue[RED].Duty =  j;
 850   3                  RedGreenBlue[GREEN].Duty = 0;
 851   3                  RedGreenBlue[BLUE].Duty = MAX_STEP;
 852   3                      }
 853   2              else if(i==5)
 854   2                      {
 855   3                              RedGreenBlue[RED].Duty =  MAX_STEP;
 856   3                  RedGreenBlue[GREEN].Duty = 0;
 857   3                  RedGreenBlue[BLUE].Duty = MAX_STEP-j;
 858   3                      }
 859   2              }//end E6
C51 COMPILER V9.01   EFFECT                                                                12/17/2025 14:59:02 PAGE 15  

 860   1          else if(Prog_Effect==7) //Program Effect 7
 861   1              {  // Bat tat 6 lan tung mau trong 7 mau
 862   2      //        RGB_SetModeSpeed(0x05);
 863   2                      RGB_SetModeSpeed(12);
 864   2              if(++k>1)
 865   2              {   //k = on/off
 866   3                  k=0;
 867   3                  if(++j>5)
 868   3                  {  //j = lan chop
 869   4                      j=0;
 870   4                      if(++i>6){ i=0; Run_Effect_Done = 1; } //i = sang so mau, Done Effect
 871   4                  }
 872   3              }
 873   2              if(k == 1)RGB_SetColor(ColorTable[i], Bright); //ON COLOR
 874   2              else RGB_SetColor(RGB_BLACK, Bright); //OFF COLOR
 875   2          }//end E7
 876   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   5037    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     79      18
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =      1    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
